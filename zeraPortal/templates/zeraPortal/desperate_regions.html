{% extends "zeraPortal/zera_base.html" %}
{% load humanize %}
{% block body %}



    <section class="content-header">
        <form action="#" method="get" class="sidebar-form search-box pull-right hidden-md hidden-lg hidden-sm">
            <div class="input-group">
                <input type="text" name="q" class="form-control" placeholder="Search...">
                <span class="input-group-btn">
                 <button type="submit" name="search" id="search-btn" class="btn"><i class="fa fa-search"></i></button>
             </span>
            </div>
        </form>
        <!-- <div class="header-icon">
            <i class="fa fa-sticky-note"></i>
        </div> -->
        <div class="header-title" style="margin-left: 0px;">
            <h1>Desperate Regions</h1>
            <small>Zimbabwe Fuel Management System</small>

        </div>
    </section>


    <section class="content">
        <div class="panel panel-bd lobidrag lobipanel lobipanel-sortable" data-inner-id="nMPzTfz4dU" data-index="0">
            <div class="panel-heading ui-sortable-handle">
                <div class="btn-group">
                    <h4>Desperate Regions</h4>
                </div>
                <div class="dropdown">
                    <ul class="dropdown-menu dropdown-menu-right">
                    </ul>
                    <div class="dropdown-toggle" data-toggle="dropdown"><span class="panel-control-icon glyphicon glyphicon-cog"></span>
                    </div>
                </div>
            </div>

            <div class="panel-body">
                <div class="table-responsive">
                    <table id="subsidiaries" class="table table-striped table-bordered" style="width:100%">
                        <thead>
                        <tr>
                            <th>Region</th>
                            <th>Deficit <em>(L)</em> </th>
                            <!-- <th>Action</th> -->
                        </tr>
                        </thead>
                        <tbody>
                        {% for region, deficit in regions.items %}
                            <tr>
                                <td>{{ region }}</td>
                                <td>{{ deficit|intcomma }}</td>
                                <!-- <td>
                                    <div class="text-center">
                                        <button class="btn btn-primary btn-sm" data-toggle="modal" data-target="#view{{ forloop.counter }}">
                                            View On Map
                                        </button>
                                    </div>
                                    <!--map modal--
                                    <div class="modal fade modal-success in" id="view{{ forloop.counter }}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                        <div class="modal-dialog" role="document" >
                                            <div class="modal-content">

                                                <div class="modal-header">
                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button>
                                                    <span class="modal-title">{{ region }}'s Location</span>
                                                </div>
                                                <div class="modal-body">
                                                    {% for location, place in mapping.items %}
                                                        {% if location == region %}
                                                            <div class="justify-content-center align-items-center w-100">
                                                                <div class="mapouter"><div class="gmap_canvas"><iframe width="500" height="500" id="gmap_canvas" src="https://maps.google.com/maps?q={{place}}&t=&z=13&ie=UTF8&iwloc=&output=embed" frameborder="0" scrolling="no" marginheight="0" marginwidth="0"></iframe></div>
                                                                <style>
                                                                .mapouter{
                                                                    position:center;text-align:right;height:500px;width:500px;
                                                                    }
                                                                .gmap_canvas {
                                                                    overflow:hidden;background:none!important;height:500px;width:500px;
                                                                    }
                                                                </style>
                                                            </div>
                                                            </div>
                                                        {% endif %}
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </td> -->
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>

            </div>
        </div>
    </section>

    <!-- <section class="content">
        <div class="col-xs-12 col-sm-12 lobipanel-parent-sortable ui-sortable" data-lobipanel-child-inner-id="veKF9LUXFI">
            <div class="panel panel-bd lobidrag lobipanel lobipanel-sortable" data-inner-id="veKF9LUXFI" data-index="0">
                <div class="panel-heading ui-sortable-handle">
                    <div class="panel-title" style="max-width: calc(100% - 180px);">
                        <h4>Map Of Desperate Regions</h4>
                        <p style="font-size: 13px;font-weight: 600;">({% for region, loc in regions.items %}{{region}}{% endfor %})</p>
                    </div>
                <div class="dropdown"><ul class="dropdown-menu dropdown-menu-right"><li><a data-func="editTitle" data-tooltip="Edit title" data-toggle="tooltip" data-title="Edit title" data-placement="bottom" data-original-title="" title=""><i class="panel-control-icon ti-pencil"></i><span class="control-title">Edit title</span></a></li><li><a data-func="unpin" data-tooltip="Unpin" data-toggle="tooltip" data-title="Unpin" data-placement="bottom" data-original-title="" title=""><i class="panel-control-icon ti-move"></i><span class="control-title">Unpin</span></a></li><li><a data-func="reload" data-tooltip="Reload" data-toggle="tooltip" data-title="Reload" data-placement="bottom" data-original-title="" title=""><i class="panel-control-icon ti-reload"></i><span class="control-title">Reload</span></a></li><li><a data-func="minimize" data-tooltip="Minimize" data-toggle="tooltip" data-title="Minimize" data-placement="bottom" data-original-title="" title=""><i class="panel-control-icon ti-minus"></i><span class="control-title">Minimize</span></a></li><li><a data-func="expand" data-tooltip="Fullscreen" data-toggle="tooltip" data-title="Fullscreen" data-placement="bottom" data-original-title="" title=""><i class="panel-control-icon ti-fullscreen"></i><span class="control-title">Fullscreen</span></a></li><li><a data-func="close" data-tooltip="Close" data-toggle="tooltip" data-title="Close" data-placement="bottom" data-original-title="" title=""><i class="panel-control-icon ti-close"></i><span class="control-title">Close</span></a></li></ul><div class="dropdown-toggle" data-toggle="dropdown"><span class="panel-control-icon glyphicon glyphicon-cog"></span></div></div></div>
                <div class="panel-body">
                    <div class="embed-container">
                        <div class="mapouter">
                            <div class="gmap_canvas">
                                <iframe width="500" height="500" id="gmap_canvas" src="https://maps.google.com/maps?q={% for location, place in mapping.items %} {% for region, deficit in regions.items %} {% if location == region %} {{place.0}},{{place.1}}{% endif %}{% endfor %}{% endfor %}&hl=en&z=7&amp;output=embed" frameborder="0" scrolling="no" marginheight="0" marginwidth="0">
                                </iframe>
                            </div>
                            <style>
                            .mapouter{
                                position:center;text-align:right;height:700px;width:1000px;
                                }
                            .gmap_canvas {
                                overflow:hidden;background:none!important;height:700px;width:1000px;
                                }
                            </style>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section> -->

    <section class="content">
        <div class="row">
            
            <div class="col-xs-12 col-sm-12 lobipanel-parent-sortable ui-sortable"
                data-lobipanel-child-inner-id="veKF9LUXFI">
                <div class="panel panel-bd lobidrag lobipanel lobipanel-sortable"
                    data-inner-id="veKF9LUXFI" data-index="0">
                    <div class="panel-heading ui-sortable-handle">
                        <div class="panel-title" style="max-width: calc(100% - 180px);">
                            <h4>Desperate Regions</h4>
                        </div>
                        <div class="dropdown">
                            <ul class="dropdown-menu dropdown-menu-right">
                                <li><a data-func="editTitle" data-tooltip="Edit title"
                                    data-toggle="tooltip" data-title="Edit title"
                                    data-placement="bottom" data-original-title="" title=""><i
                                        class="panel-control-icon ti-pencil"></i><span
                                        class="control-title">Edit title</span></a></li>
                                <li><a data-func="unpin" data-tooltip="Unpin" data-toggle="tooltip"
                                    data-title="Unpin" data-placement="bottom" data-original-title=""
                                    title=""><i class="panel-control-icon ti-move"></i><span
                                        class="control-title">Unpin</span></a></li>
                                <li><a data-func="reload" data-tooltip="Reload" data-toggle="tooltip"
                                    data-title="Reload" data-placement="bottom"
                                    data-original-title="" title=""><i
                                        class="panel-control-icon ti-reload"></i><span
                                        class="control-title">Reload</span></a></li>
                                <li><a data-func="minimize" data-tooltip="Minimize"
                                    data-toggle="tooltip" data-title="Minimize"
                                    data-placement="bottom" data-original-title="" title=""><i
                                        class="panel-control-icon ti-minus"></i><span
                                        class="control-title">Minimize</span></a></li>
                                <li><a data-func="expand" data-tooltip="Fullscreen"
                                    data-toggle="tooltip" data-title="Fullscreen"
                                    data-placement="bottom" data-original-title="" title=""><i
                                        class="panel-control-icon ti-fullscreen"></i><span
                                        class="control-title">Fullscreen</span></a></li>
                                <li><a data-func="close" data-tooltip="Close" data-toggle="tooltip"
                                    data-title="Close" data-placement="bottom" data-original-title=""
                                    title=""><i class="panel-control-icon ti-close"></i><span
                                        class="control-title">Close</span></a></li>
                            </ul>
                            <div class="dropdown-toggle" data-toggle="dropdown"><span
                                    class="panel-control-icon glyphicon glyphicon-cog"></span></div>
                        </div>
                    </div>
                    <div class="panel-body">
                        
                        <div class="embed-container">
                                   
                            <!-- <iframe width="425" height="350" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="https://www.openstreetmap.org/export/embed.html?bbox=21.687011718750004%2C-22.105998799750566%2C33.94775390625001%2C-15.855673509998681&amp;layer=mapnik" style="border: 1px solid black"></iframe>
                            <br/>
                            <small><a href="https://www.openstreetmap.org/#map=7/-19.010/27.817">View Larger Map</a></small>
                                     -->

                            <div id="map" style="width: 1000px; height: 850px;border: mintcream solid 3px;"></div>
                            <div id="popup" class="ol-popup">
                                <a href="#" id="popup-closer" class="ol-popup-closer"></a>
                                <div id="popup-content"></div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>    

<script src="https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.3.0/build/ol.js"></script>   

<script>
     var attribution = new ol.control.Attribution({
     collapsible: false
        });

        var map = new ol.Map({
            controls: ol.control.defaults({attribution: false}).extend([attribution]),
            layers: [
                new ol.layer.Tile({
                    source: new ol.source.OSM({
                        url: 'https://tile.openstreetmap.org/{z}/{x}/{y}.png',
                        attributions: [ ol.source.OSM.ATTRIBUTION, 'Tiles courtesy of <a href="https://geo6.be/">GEO-6</a>' ],
                        maxZoom: 18
                    })
                })
            ],
            target: 'map',
            view: new ol.View({
                center: ol.proj.fromLonLat([29.1549, -19.0154]),
                maxZoom: 18,
                zoom: 7
            })
        });

        test_array = [[30.1936, -17.3653],[29.1549, -19.0154]]

        var coordinates= {{coordinates}};

        coordinates.forEach(function (arrayItem) {
            var layer = new ol.layer.Vector({
                source: new ol.source.Vector({
                    features: [
                        new ol.Feature({
                            geometry: new ol.geom.Point(ol.proj.fromLonLat(arrayItem))
                        })
                    ]
                })
            });
            map.addLayer(layer);
        });
        

        // var layer = new ol.layer.Vector({
        //     source: new ol.source.Vector({
        //         features: [
        //             new ol.Feature({
        //                 geometry: new ol.geom.Point(ol.proj.fromLonLat([29.1549, -19.0154]))
        //             })
        //         ]
        //     })
        // });

        // var layer3 = new ol.layer.Vector({
        //     source: new ol.source.Vector({
        //         features: [
        //             new ol.Feature({
        //                 geometry: new ol.geom.Point(ol.proj.fromLonLat([30.1936, -17.3653]))
        //             })
        //         ]
        //     })
        // });

        // test_array = [[30.1936, -17.3653],[29.1549, -19.0154]]

        
        
        // var coordinates = {{coordinates}};

        // map.addLayer(layer3);
        // map.addLayer(layer);    

</script>
<script>
     var container = document.getElementById('popup');
    var content = document.getElementById('popup-content');
    var closer = document.getElementById('popup-closer');

    var overlay = new ol.Overlay({
        element: container,
        autoPan: true,
        autoPanAnimation: {
            duration: 250
        }
    });
    map.addOverlay(overlay);

    closer.onclick = function() {
        overlay.setPosition(undefined);
        closer.blur();
        return false;
    };
</script>

<script>
     map.on('singleclick', function (event) {
     if (map.hasFeatureAtPixel(event.pixel) === true) {
         var coordinate = event.coordinate;

         content.innerHTML = '<b style="color: #374767;">This is  desperate region!</b><br /> - DEFICIT.';
         overlay.setPosition(coordinate);
     } else {
         overlay.setPosition(undefined);
         closer.blur();
     }
    });
</script>
{% endblock %}