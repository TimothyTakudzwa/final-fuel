{% extends "supplier/supplier_base.html" %}
{% load static %}
{% load humanize %}

{% block body %}
<!-- Content Header (Page header) -->
<section class="content-header">
    <form action="#" method="get" class="sidebar-form search-box pull-right hidden-md hidden-lg hidden-sm">
        <div class="input-group">
            <input type="text" name="q" class="form-control" placeholder="Search...">
            <span class="input-group-btn">
                <button type="submit" name="search" id="search-btn" class="btn"><i
                        class="fa fa-search"></i></button>
            </span>
        </div>
    </form>
    <div class="header-icon">
        <i class="fa fa-binoculars"></i>
    </div>
    <div class="header-title">
        <h1>Fuel Requests</h1>
        <small>List of All Fuel Requests</small>
        <ol class="breadcrumb hidden-xs">
            <li><a href="{%url 'fuel-request'%}"><i class="pe-7s-home"></i> Home</a></li>
            <li class="active">Requests</li>
        </ol>
    </div>
</section>
<!-- Main content -->
<div class="content">
    <div class="panel panel-bd lobidrag lobipanel lobipanel-sortable" data-inner-id="nMPzTfz4dU"
        data-index="0">
        <div class="panel-heading ui-sortable-handle">
            <div class="btn-group"> 
                <a class="btn btn-success" href="{% url 'activate_whatsapp' %}" style="background-color: #25d366;"><i class="fa fa-whatsapp" style="margin-right: 11px;"></i>
                    {% if request.user.activated_for_whatsapp %}
                        Deactivate Whatsapp
                    {% else %}
                        Activate Whatsapp
                    {% endif %}
                </a>  
            </div>
            
            <div class="dropdown">
                <ul class="dropdown-menu dropdown-menu-right">


                </ul>
                <div class="dropdown-toggle" data-toggle="dropdown"><span
                        class="panel-control-icon glyphicon glyphicon-cog"></span>
                </div>
            </div>
        </div>
        <div class="panel-body">              
      
      <div class="table-responsive">
        <table id="fuel_request" class="table table-striped table-bordered" style="width:100%">
            <thead style="background-color: lightslategray; color:white;">
                <tr>
                    <th style="color: white;"></th>
                    <th style="color: white;">Date</th>
                    <th style="color: white;">Buyer</th>
                    <th style="color: white;">Quantity</th>
                    <th style="color: white;">Fuel</th>
                    <th style="color: white;">Payment</th>
                    <th style="color: white;">Delivery</th>
                    <th style="color: white;">Address</th>
                    <th style="color: white;">Equipment</th>
                    <th style="color: white;">Offer</th>
                    <th style="color: white;">Action</th>
                </tr>
            </thead>
            <tbody>
                {% for req in requests %}
                <tr>
                    <td></td>
                    <td>{{ req.date }}</td>
                    <td>{{ req.name.company.name|lower|title }}</td>
                    <td>{{ req.amount|intcomma }}</td>
                    <td>{{ req.fuel_type|lower|capfirst }}</td>
                    <td>{{req.payment_method}}</td>                    
                    <td>{{ req.delivery_method|lower|capfirst }}</td>
                    <td>{{ req.delivery_address|lower|title}}</td>                                    
                    <td>{% if req.dipping_stick_required %}Stick &nbsp;{% endif %}{% if req.pump_required %}Pump &nbsp;{% endif %}{% if req.meter_required %}Meter&nbsp;{% endif %}{% if req.no_equipments %}No Equipment Required{% endif %}</td>
                    <td>{{ req.my_offer }}</td>
                    {% if req.my_offer != 'No Offer' %}
                    <td><button type="button" class="btn btn-purple btn-sm" data-toggle="modal"
                            data-target="#edit_offer_{{req.id}}">Edit Offer</button></td>
                    {% else %}
                    <td><button type="button" class="btn btn-info btn-sm" data-toggle="modal" data-target="#add_offer_{{req.id}}">Make Offer</button></td>
                    {% endif %}
                </tr>
                <script>
                    $(document).ready(function () {
                      $('#choices{{forloop.counter}}').hide();
                      $('#choices1{{forloop.counter}}').hide();
                  
                      $('#delivery_method1{{forloop.counter}}').change(function () {
                        if ($('#delivery_method1{{forloop.counter}} option:selected').text() == "Delivery") {
                          $('#choices1{{forloop.counter}}').hide();
                          $('#location1{{forloop.counter}}').removeAttr('required', '');
                          $('#street_number1{{forloop.counter}}').removeAttr('required', '');
                          $('#street_name1{{forloop.counter}}').removeAttr('required', '');
                        }
                        else {
                          $('#choices1{{forloop.counter}}').show();
                          $('#street_name1{{forloop.counter}}').attr('required', '');
                          $('#street_number1{{forloop.counter}}').attr('required', '');
                          $('#location1{{forloop.counter}}').attr('required', '');                                        
                        }
                      });
                      $('#delivery_method{{forloop.counter}}').change(function () {
                        if ($('#delivery_method{{forloop.counter}} option:selected').text() == "Self Collection") {
                          $('#choices{{forloop.counter}}').show();
                          $('#street_name{{forloop.counter}}').attr('required', '');
                          $('#street_number{{forloop.counter}}').attr('required', '');
                          $('#location{{forloop.counter}}').attr('required', '');
                        }
                        else {
                          $('#choices{{forloop.counter}}').hide();
                          $('#location{{forloop.counter}}').removeAttr('required', '');
                          $('#street_number{{forloop.counter}}').removeAttr('required', '');
                          $('#street_name{{forloop.counter}}').removeAttr('required', '');
                        }
                      });
                    });
                  
                    $('#pump_available').on('change', function () {
                      $(this).val(this.checked ? "True" : "False");
                    });
                    $('#swipe').on('change', function () {
                      $(this).val(this.checked ? "True" : "False");
                    });
                    $('#ecocash').on('change', function () {
                      $(this).val(this.checked ? "True" : "False");
                    });
                    $('#cash').on('change', function () {
                      $(this).val(this.checked ? "True" : "False");
                    });
                    $('#usd').on('change', function () {
                      $(this).val(this.checked ? "True" : "False");
                    });
                  
                    $('#dipping_stick_available').on('change', function () {
                      $(this).val(this.checked ? "True" : "False");
                    });
                  
                    $('#meter_available').on('change', function () {
                      $(this).val(this.checked ? "True" : "False");
                    });
                  </script>

                <!-- make offer modal -->
<div class="modal fade modal-success in" id="add_offer_{{req.id}}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
aria-hidden="true">
<div class="modal-dialog modal-notice">
<div class="modal-content">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
        <h2 class="modal-title">Make Offer</h2>
    </div>
<div class="modal-body">
<form method="POST" action="{% url 'supplier:supplier' req.id %}">
    {% csrf_token %}
    <div class=" row col-sm-12">
    <div class="col-sm-3">
        <label>Fuel Type</label>
        <input type="text" name="fuel_type" class="form-control" value="{{req.fuel_type}}" disabled/>
    </div>

    <div class="col-sm-3">
        <label>Fuel Quantity</label>
        <input type="text" name="quantity" class="form-control" value="{{req.amount}}" required/>
    </div>
    <div class="col-sm-3">
        <label>Fuel Price</label>
        <input type="text" name="price" class="form-control" value="{{req.price}}" required/>
    </div>
    <div class="col-sm-3">
      <label>Transport Fee</label>
      <input type="text" name="transport" class="form-control" value="" />
  </div>
    </div>


    <div class="row col-sm-12 form-group" style="margin-top: 5;">
        <label class="col-sm-12">Pick Up Method</label>
        <div class="col-sm-12">
        <select id="delivery_method{{forloop.counter}}" name="delivery_method" class="form-control">
                <option value='DELIVERY'>Delivery</option>
            <option value='SELF COLLECTION'>Self Collection</option>
        </select>
        </div>
    </div>

    <div class="form-group" name='choices' id='choices{{forloop.counter}}'>                
        <p style="text-align: center;"><label>Collection Address</label></p>
        <div class=" row col-sm-12">                            
            <div class="togglebutton col-sm-4">
              <label for="">Street Number</label>
              <input type="text" class="form-control" name="street_number" id="street_number{{forloop.counter}}" aria-describedby="helpId" placeholder="">
              
            </div>
            <div class="togglebutton col-sm-4">
              <label for="">Street Name</label>
              <input type="text" class="form-control" name="street_name" id="street_name{{forloop.counter}}" aria-describedby="helpId" placeholder="">
              
            </div>
            <div class="togglebutton col-sm-4">
              <label for="">Location/Town</label>
              <input type="text" class="form-control" name="location" id="location{{forloop.counter}}" aria-describedby="helpId" placeholder="">
             
            </div>
            </div>
        <p style="text-align: center;"><label>Available Equipments</label></p>
        <div class="col-sm-12">
            <div class="col-sm-4">
                <input class="form-control-md" type="checkbox" value="False" name="pump_available">
                <label for="pump_available">Pump </label>
                
            </div>
            <div class="col-sm-4">
                <input class="form-control-md" type="checkbox" value="False" name="dipping_stick_available">
                <label for="dipping_stick_available">Dipping Stick </label>
            </div>

            <div class="col-sm-4">
                <input class="form-control-md" type="checkbox" value="False" name="meter_available">
                <label for="meter_available">Meter</label>
            </div>
        </div>
        </div>
</div>
<p style="text-align: center;"><button type="submit" name="MakeOffer" class="btn btn-primary">Make Offer</button></p>
</form>
</div>
</div>
</div>
<!-- end make offer modal -->


<!-- edit modal -->
<div class="modal fade modal-success in" id="edit_offer_{{req.id}}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
aria-hidden="true">
<div class="modal-dialog modal-notice">
<div class="modal-content">
<div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    <h2 class="modal-title">Edit Offer</h2>
</div>
<div class="modal-body">
 <form method="POST" action="{% url 'supplier:edit_offer' req.offer_id %}">
     {% csrf_token %}
     <div class=" row col-sm-12">
     <div class="col-sm-3">
         <lable>Fuel Type</lable>
         <input type="text" name="fuel_type" class="form-control" value="{{req.fuel_type}}" disabled/>
     </div>

     <div class="col-sm-3">
         <lable>Fuel Quantity</lable>
         <input type="text" name="quantity" class="form-control" value="{{req.offer_quantity}}" />
     </div>
     <div class="col-sm-3">
         <lable>Fuel Price</lable>
         <input type="text" name="price" class="form-control" value="{{req.offer_price}}"/>
     </div>
     <div class="col-sm-3">
      <lable>Transport Fee</lable>
      <input type="text" name="transport" class="form-control" value="{{req.transport_fee}}"/>
  </div>
     </div>


    <div class="row col-sm-12 form-group" style="margin-top: 5;">
         <label class="col-sm-12">Pick Up Method</label>
         <div class="col-sm-12">
         <select id="delivery_method1{{forloop.counter}}" name="delivery_method1" class="form-control">
            <option value='DELIVERY'>Delivery</option>
            <option value='SELF COLLECTION'>Self Collection</option>
         </select>
         </div>
     </div>

     <div class="form-group" name='choices1' id='choices1{{forloop.counter}}'>
        <p style="text-align: center;"><label>Collection Address</label></p>
         <div class=" row col-sm-12">                          
            <div class="togglebutton col-sm-4">
              <label for="">Street Number</label>
              <input type="text" class="form-control" name="street_number" id="street_number1{{forloop.counter}}" aria-describedby="helpId" placeholder="">
              
            </div>
            <div class="togglebutton col-sm-4">
              <label for="">Street Name</label>
              <input type="text" class="form-control" name="street_name" id="street_name1{{forloop.counter}}" aria-describedby="helpId" placeholder="">
              
            </div>
            <div class="togglebutton col-sm-4">
              <label for="">Location/Town</label>
              <input type="text" class="form-control" name="location" id="location1{{forloop.counter}}" aria-describedby="helpId" placeholder="">
            </div>
            </div>
        <p style="text-align: center;"><label>Available Equipments</label></p>
         <div class="col-sm-12">
            <div class="col-sm-4">
                <input class="form-control-md" type="checkbox" value="False" name="pump_available">
                <label for="pump_available">Pump </label>
                
            </div>
            <div class="col-sm-4">
                <input class="form-control-md" type="checkbox" value="False" name="dipping_stick_available">
                <label for="dipping_stick_available">Dipping Stick </label>
            </div>

            <div class="col-sm-4">
                <input class="form-control-md" type="checkbox" value="False" name="meter_available">
                <label for="meter_available">Meter</label>
            </div>
        </div>
        </div>
</div>
    <p style="text-align: center;"><button type="submit" name="MakeOffer" class="btn btn-info btn-sm">Update Offer</button></p>
</form>
</div>
</div>
</div>
<!-- end edit modal -->
                {%endfor%}
            </tbody>
            </table>

</div>
</div>
</div>
</div>
    {%endblock%}