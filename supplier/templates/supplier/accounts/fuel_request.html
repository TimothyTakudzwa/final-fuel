{% extends "supplier/dashboard.html" %}
{% load static %}
{% block title %}
{{title}}
{% endblock %}
{% block body %}
<script>
    $(document).ready(function () {
        var socket = io.connect('http://' + document.domain + ':5000/new_offer');
        console.log(socket)
        socket.on('new_offer', function (msg) {
            $('.new_alert').hide()
            var txt1 = " <h4 class='alert-heading'>New Request</h4><hr>" + msg.notification +  "<hr><small>Click to View </small></hr>";   
            $("#new_message").empty(txt1);   
            $("#new_message").append(txt1);  
            $('.new_alert').show()


        });
    });
</script>

<div  style="display:none" class=" new_alert alert alert-success alert-dismissible fade show" role="alert">
    
  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
  <strong><i data-notify="icon" class="material-icons">add_alert</i><span
    data-notify="title"></span> <div id='new_message' ></div><a href="#" target="_blank" data-notify="url"></a></strong> 
</div>

<script>
  $(".alert").alert();
</script>
<!-- <div data-notify="container" style="display: none;" class="col-11 col-md-4 alert alert-info alert-with-icon animated fadeInDown" role="alert"
    data-notify-position="top-center"
    style="display: inline-block; margin: 15px auto; position: fixed; transition: all 0.5s ease-in-out 0s; z-index: 1031; top: 20px; left: 0px; right: 0px;">
    <button type="button" aria-hidden="true" class="close" data-notify="dismiss"
        style="position: absolute; right: 10px; top: 50%; margin-top: -9px; z-index: 1033;"><i
            class="material-icons">close</i></button><i data-notify="icon" class="material-icons">add_alert</i><span
        data-notify="title"></span> <span data-notify="message">Welcome to <b>Material Dashboard Pro</b> - a beautiful
        admin panel for every web developer.</span><a href="#" target="_blank" data-notify="url"></a></div> -->
    <div class="jumbotron jumbotron-fluid">
        <div class="container">
            <h1 class="display-3">Fuel Requests</h1>
            <p class="lead">

                {% if user.activated_for_whatsapp == True %}
                <a class="btn btn-outline-danger" href="{% url 'activate_whatsapp' %}">Deactivate Whatsapp</a>
                {% else %}
                <a class="btn btn-outline-primary" href="{% url 'activate_whatsapp' %}">Activate Whatsapp</a>
                {% endif %}

            </p>

        </div>
    </div>
    <div class="col-md-12">
        <div class="card mt-5" style="background-color:white">
            <div class="card-header card-header-primary">
                <h4 class="card-title">Today's Requests</h4>
                <p class="card-category"> List Of All Requests</p>
            </div>
            <div class="card-body">
                <div class="container-fluid">
                    <table id="example" class="table table-striped table-bordered" style="width:100%">
                        <thead style="background-color: lightslategray; color:white;">
                            <tr>
                                <th style="color: white;"></th>
                                <th style="color: white;"> Name </th>
                                <th style="color: white;">Quantity(l) </th>
                                <th style="color: white;">Fuel Type</th>
                                <th style="color: white;">Payment Method</th>
                                <th style="color: white;">Delivery Method</th>
                                <th style="color: white;">My Offer</th>
                                <th style="color: white;">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for request in requests %}
                            <tr>
                                <td></td>
                                <td>{{ request.name }}</td>
                                <td>{{ request.amount }}</td>
                                <td>{{ request.fuel_type }}</td>
                                <td>{{ request.payment_method }}</td>
                                <td>{{ request.delivery_method }}</td>
                                <td>{{ request.my_offer }}</td>
                                {% if request.my_offer %}
                                <td><button type="button" class="btn btn-info btn-sm" data-toggle="modal"
                                        data-target="#edit_offer_{{request.id}}">Edit Offer</button></td>
                                {% else %}
                                <td><button type="button" class="btn btn-success btn-sm" data-toggle="modal"
                                        data-target="#add_offer_{{request.id}}">Make Offer</button></td>
                                {% endif %}
                            </tr>
                            
                                <!-- Make offer Modal -->
                       <!-- <div class="modal fade" id="add_offer_{{request.id}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="exampleModalLabel">Upload</h5>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                            {% load crispy_forms_tags %}
                                            <form action="{% url 'supplier:supplier' request.id %}" method="POST">
                                                {% csrf_token %}
                                                <div class="form-group">
                                                    <lable>Fuel Quantity</lable>
                                                    <input type="text" name="quantity" class="form-control"
                                                        value="{{request.amount}}" />
                                                </div>
                                                <div class="form-group">
                                                    <lable>Fuel Price</lable>
                                                    <input type="text" name="price" class="form-control"
                                                        value="{{request.price}}" />
                                                </div>
                                                <button class="btn btn-primary" type="submit">Confirm</button>
                                            </form>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary"
                                                data-dismiss="modal">Close</button>
                                        </div>
                                    </div>
                                </div>
                                </div>
                            </div>-->


                            <!-- notice modal -->
<div class="modal fade modal-xl" id="add_offer_{{request.id}}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
aria-hidden="true">
<div class="modal-dialog modal-notice">
    <div class="modal-content">
        <div class="modal-header text-center">
            <h5 class="modal-title" id="myModalLabel">Make an offer</h5>
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                <i class="material-icons">close</i>
            </button>
        </div>
        <div class="modal-body">
            <form method="POST" action="{% url 'supplier:supplier' request.id %}">
                {% csrf_token %}
                <div class="form-group">
                    <lable>Fuel Type</lable>
                    <input type="text" name="fuel_type" class="form-control" value="{{request.fuel_type}}" disabled/>
                </div>

                <div class="form-group">
                    <lable>Fuel Quantity</lable>
                    <input type="text" name="quantity" class="form-control" value="{{request.amount}}" />
                </div>
                <div class="form-group">
                    <lable>Fuel Price</lable>
                    <input type="text" name="price" class="form-control" value="{{request.price}}" />
                </div>
                <label class="form-group">Select Payment Method</label>
                <div class="col-sm-12 row">
                    <div class="togglebutton form-group col">
                        <label>

                            <input type="checkbox" name="cash" id="cash">

                            <span class="toggle"></span>
                            Cash
                        </label>
                    </div>
                    <div class="togglebutton form-group col">
                        <label>
                            <input type="checkbox" name="ecocash" id="ecocash">
                            <span class="toggle"></span>
                            Ecocash
                        </label>
                    </div>
                    <div class="togglebutton form-group col">
                        <label>
                            <input type="checkbox" name="swipe" id="swipe">
                            <span class="toggle"></span>
                            Swipe
                        </label>
                    </div>
                    <div class="togglebutton form-group col">
                        <label>
                            <input type="checkbox" name="usd" id="usd">
                            <span class="toggle"></span>
                            USD
                        </label>
                    </div>
                </div>


                <div class="form-group">
                    <label>Pick Up Method</label>
                    <select id="delivery_method" name="delivery_method" class="form-control">
                        <option value='SELF COLLECTION'>Self Collection</option>
                        <option value='DELIVERY'>Delivery</option>
                    </select>
                </div>

                <div class="form-group" name='choices' id='choices'>
                    <label>Collection Address</label>
                    <div class="row form-group">                            
                            <div class="togglebutton form-group col">
                              <label for="">Street Number</label>
                              <input type="text" class="form-control" name="s_number" id="" aria-describedby="helpId" placeholder="">
                              
                            </div>
                            <div class="togglebutton form-group col">
                              <label for="">Street Name</label>
                              <input type="text" class="form-control" name="s_name" id="" aria-describedby="helpId" placeholder="">
                              
                            </div>
                            <div class="togglebutton form-group col">
                              <label for="">Location/Town</label>
                              <input type="text" class="form-control" name="s_town" id="" aria-describedby="helpId" placeholder="">
                             
                            </div>
                        
                    </div>
                    <label>Required Equipments</label>
                    <div class="row">
                        <div class="col">
                            <input class="form-control-md" type="checkbox" value='False' id="pump_available"
                                name="pump_available">
                            <label for="pump_available">Pump </label>
                            
                        </div>
                        <div class="col">
                            <input class="form-control-md" type="checkbox" value="False" id="dipping_stick_available"
                                name="dipping_stick_available">
                            <label for="dipping_stick_available">Dipping Stick </label>
                        </div>

                        <div class="col">
                            <input class="form-control-md" type="checkbox" value="False" id="meter_available"
                                name="meter_available">
                            <label for="meter_available">Meter</label>
                        </div>
                    </div>
                </div>
        </div>

        <div class="modal-footer justify-content-center">
            <button type="submit" name="MakeOffer" class="btn btn-info btn-round">Make Offer</button>

        </div>
        </form>
    </div>
</div>
</div>
<!-- end notice modal -->

                            <!-- Edit offer Modal -->
                            <div class="modal fade" id="edit_offer_{{request.id}}" tabindex="-1" role="dialog"
                                aria-labelledby="exampleModalLabel" aria-hidden="true">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="exampleModalLabel">Upload</h5>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                            {% load crispy_forms_tags %}
                                            <form action="{% url 'supplier:edit_offer' request.offer_id %}"
                                                method="POST">
                                                {% csrf_token %}
                                                <div class="form-group">
                                                    <lable>Fuel Quantity</lable>
                                                    <input type="text" name="quantity" class="form-control"
                                                        value="{{request.offer_quantity}}" />
                                                </div>
                                                <div class="form-group">
                                                    <lable>Fuel Price</lable>
                                                    <input type="text" name="price" class="form-control"
                                                        value="{{request.offer_price}}" />
                                                </div>
                                                <button class="btn btn-primary" type="submit">Confirm</button>
                                            </form>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary"
                                                data-dismiss="modal">Close</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {%endfor%}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

{%endblock%}