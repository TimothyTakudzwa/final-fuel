{% extends "supplier/dashboard.html" %}
{% load static %}
{% load humanize %}
{% block title %}
{{title}}
{% endblock %}
{% block body %}

<script>
    $(document).ready(function () {
        var logged_user = {{user.id}}
        var socket = io.connect('https://dreamhub.co.zw/new_offer');
        console.log("Got to this part ")
        console.log(socket)
        socket.on('new_offer', function (msg) {
            console.log("There is a new offer on the rise", logged_user, msg.user_id)
            if (logged_user == msg.user_id){
                $('.new_alert').hide()
                var txt1 = "<h4 class='alert-heading' style='text-align: center;'>New Request</h4><hr>" + msg.notification + "<hr><small style='text-align: center;'>Click to View </small></hr>";
                $("#new_message").empty(txt1);
                $("#new_message").append(txt1);
                $(".new_alert").fadeTo(10000, 1000).slideUp(1000, function(){
                    $(".new_alert").slideUp(1000);
                }); 
            }   
        });
    });
</script>




<div class="new_alert alert alert-success alert-dismissible fade show" role="alert" style="border-radius: 5px;padding: 8px;font-size: 12px;max-width: 97%;
;background-color: #505577e8;margin-left: 15px;margin-top: 10px;" >

    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
    </button>
    <strong><i data-notify="icon" class="material-icons">add_alert</i><span data-notify="title"></span>
            <h4 class='alert-heading' style="text-align: center;">
                <div id='new_message'><i class="material-icons" style="color: gold;line-height: 0;margin-right: 3px;">add_alert</i>
                
                New Request</h4><hr>
            <p style="text-align: center;margin-top: 13px;background-color: #707aa785;padding: 10px;border-radius: 8px;">
                When you say that you love her eand you really know everything that used to matter dont matter no more like my money all my cars, you can have it all girl. Flowers cardss and candy, said um fortunate to have you girl i want you to know i really adore you</p><hr><small style="text-align: center;"><p>Click to View</p> </small></hr></div><a href="#" target="_blank" data-notify="url"></a>
    
            </strong>

</div>
<div class="col-md-12">
<div class="jumbotron jumbotron-fluid" style="padding: 1rem 1rem;">
    <div class="container">
        <h1 class="display-3">Fuel Requests</h1>
        <hr class="my-2">
        <p class="lead">
            <a class="btn btn-outline-primary" href="{% url 'activate_whatsapp' %}" style="margin-top: 23px;margin-bottom: 0;margin-left: 30px;background-color: #25d366;color: white;border: none;">
                <i class="fa fa-whatsapp" style="margin-right: 11px;"></i>
                {% if request.user.activated_for_whatsapp %}
                    Deactivate Whatsapp
                {% else %}
                    Activate Whatsapp
                {% endif %}
            </a>
        </p>

    </div>
</div>    
    <div class="col-md-12">
            <div class="card mt-5" style="background-color:white">
                <div class="card-header card-header-primary">
                    <h4 class="card-title">Fuel Requests</h4>
                    <p class="card-category"> List Of All Requests</p>
                </div>
                <div class="card-body">
                    <div class="container-fluid">
                        <table id="example" class="table table-striped table-bordered" style="width:100%">
                            <thead style="background-color: lightslategray; color:white;">
                                <tr>
                                    <th style="color: white;"></th>
                                    <th style="color: white;">Date</th>
                                    <th style="color: white;">Buyer</th>
                                    <th style="color: white;">Quantity(l) </th>
                                    <th style="color: white;">Fuel</th>
                                    <th style="color: white;">Payment</th>
                                    <th style="color: white;">Delivery</th>
                                    <th style="color: white;">Address</th>
                                    <th style="color: white;">Equipments</th>
                                    <th style="color: white;">Offer</th>
                                    <th style="color: white;">Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for req in requests %}
                                <tr>
                                    <td></td>
                                    <td>{{ req.date }}</td>
                                    <td>{{ req.name.first_name|lower|capfirst }} {{ req.name.last_name|lower|capfirst }}</td>
                                    <td>{{ req.amount|intcomma }}</td>
                                    <td>{{ req.fuel_type|lower|capfirst }}</td>
                                    <td>{% if req.cash %}Cash &nbsp;{% endif %}{% if req.ecocash %}Ecocash&nbsp;{% endif %}{% if req.usd %}Usd &nbsp;{% endif %}{% if req.swipe %}Swipe &nbsp;{% endif %}{% if req.no_payment %}Not Specified{% endif %}</td>
                                    <td>{{ req.delivery_method|lower|capfirst }}</td>
                                    <td>{{ req.delivery_address|lower|title}}</td>                                    
                                    <td>{% if req.dipping_stick_required %}Stick &nbsp;{% endif %}{% if req.pump_required %}Pump &nbsp;{% endif %}{% if req.meter_required %}Meter&nbsp;{% endif %}{% if req.no_equipments %}No Equipment Required{% endif %}</td>
                                    <td>{{ req.my_offer }}</td>
                                    {% if req.my_offer != 'No Offer' %}
                                    <td><button type="button" class="btn btn-info btn-sm" data-toggle="modal"
                                            data-target="#edit_offer_{{req.id}}">Edit Offer</button></td>
                                    {% else %}
                                    <td><button type="button" class="btn btn-success btn-sm" data-toggle="modal"
                                            data-target="#add_offer_{{req.id}}">Make Offer</button></td>
                                    {% endif %}
                                </tr>
                                <script>
                                    $(document).ready(function () {
                                      $('#choices{{forloop.counter}}').hide();
                                      $('#choices1{{forloop.counter}}').hide();
                                  
                                      $('#delivery_method1{{forloop.counter}}').change(function () {
                                        if ($('#delivery_method1{{forloop.counter}} option:selected').text() == "Delivery") {
                                          $('#choices1{{forloop.counter}}').hide();
                                        }
                                        else {
                                          $('#choices1{{forloop.counter}}').show();
                                          this.getField("street_name").required = true;
                                          this.getField("street_number").required = true;
                                          this.getField("location").required = true;                                        
                                        }
                                      });
                                      $('#delivery_method{{forloop.counter}}').change(function () {
                                        if ($('#delivery_method{{forloop.counter}} option:selected').text() == "Self Collection") {
                                          $('#choices{{forloop.counter}}').show();
                                          this.getField("street_name").required = true;
                                          this.getField("street_number").required = true;
                                          this.getField("location").required = true;
                                        }
                                        else {
                                          $('#choices{{forloop.counter}}').hide();
                                        }
                                      });
                                    });
                                  
                                    $('#pump_available').on('change', function () {
                                      $(this).val(this.checked ? "True" : "False");
                                    });
                                    $('#swipe').on('change', function () {
                                      $(this).val(this.checked ? "True" : "False");
                                    });
                                    $('#ecocash').on('change', function () {
                                      $(this).val(this.checked ? "True" : "False");
                                    });
                                    $('#cash').on('change', function () {
                                      $(this).val(this.checked ? "True" : "False");
                                    });
                                    $('#usd').on('change', function () {
                                      $(this).val(this.checked ? "True" : "False");
                                    });
                                  
                                    $('#dipping_stick_available').on('change', function () {
                                      $(this).val(this.checked ? "True" : "False");
                                    });
                                  
                                    $('#meter_available').on('change', function () {
                                      $(this).val(this.checked ? "True" : "False");
                                    });
                                  </script>
    
                                <!-- make offer modal -->
    <div class="modal fade modal-xl" id="add_offer_{{req.id}}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-notice">
        <div class="modal-content">
            <div class="modal-header text-center" style="background: purple; color: white;">
                <h5 class="modal-title" id="myModalLabel">Make an offer</h5>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    <i class="material-icons">close</i>
                </button>
            </div>
            <div class="modal-body">
                <form method="POST" action="{% url 'supplier:supplier' req.id %}">
                    {% csrf_token %}
                    <div class="form-group">
                        <lable>Fuel Type</lable>
                        <input type="text" name="fuel_type" class="form-control" value="{{req.fuel_type}}" disabled/>
                    </div>
    
                    <div class="form-group">
                        <lable>Fuel Quantity</lable>
                        <input type="text" name="quantity" class="form-control" value="{{req.amount}}" required/>
                    </div>
                    <div class="form-group">
                        <lable>Fuel Price</lable>
                        <input type="text" name="price" class="form-control" value="{{req.price}}" required />
                    </div>
                    <label class="form-group">Select Payment Method</label>
                    <div class="col-sm-12 row">
                            <div class="togglebutton form-group col">
                                <label>
                                    <input type="checkbox" name="cash" id="cash">
                                    <span class="toggle"></span>
                                    Cash
                                </label>
                            </div>
                            <div class="togglebutton form-group col">
                                <label>
                                    <input type="checkbox" name="ecocash" id="ecocash">
                                    <span class="toggle" value="True"></span>
                                    Ecocash
                                </label>
                            </div>
                            <div class="togglebutton form-group col">
                                <label>
                                    <input type="checkbox" name="swipe" id="swipe">
                                    <span class="toggle"></span>
                                    Swipe
                                </label>
                            </div>
                            <div class="togglebutton form-group col">
                                <label>
                                    <input type="checkbox" name="usd" id="usd">
                                    <span class="toggle"></span>
                                    USD
                                </label>
                            </div>
                        </div>
    
    
                    <div class="form-group">
                        <label>Pick Up Method</label>
                        <select id="delivery_method{{forloop.counter}}" name="delivery_method" class="form-control">
                                <option value='DELIVERY'>Delivery</option>
                            <option value='SELF COLLECTION'>Self Collection</option>
                        </select>
                    </div>
    
                    <div class="form-group" name='choices' id='choices{{forloop.counter}}'>
                        <label>Collection Address</label>
                        <div class="row form-group">                            
                                <div class="togglebutton form-group col">
                                  <label for="">Street Number</label>
                                  <input type="text" class="form-control" name="s_number" id="street_number" aria-describedby="helpId" placeholder="">
                                  
                                </div>
                                <div class="togglebutton form-group col">
                                  <label for="">Street Name</label>
                                  <input type="text" class="form-control" name="s_name" id="street_name" aria-describedby="helpId" placeholder="">
                                  
                                </div>
                                <div class="togglebutton form-group col">
                                  <label for="">Location/Town</label>
                                  <input type="text" class="form-control" name="s_town" id="location" aria-describedby="helpId" placeholder="">
                                 
                                </div>
                            
                        </div>
                        <label>Available Equipments</label>
                        <div class="row">
                            <div class="col">
                                <input class="form-control-md" type="checkbox" value='False' id="pump_available"
                                    name="pump_available">
                                <label for="pump_available">Pump </label>
                                
                            </div>
                            <div class="col">
                                <input class="form-control-md" type="checkbox" value="False" id="dipping_stick_available"
                                    name="dipping_stick_available">
                                <label for="dipping_stick_available">Dipping Stick </label>
                            </div>
    
                            <div class="col">
                                <input class="form-control-md" type="checkbox" value="False" id="meter_available"
                                    name="meter_available">
                                <label for="meter_available">Meter</label>
                            </div>
                        </div>
                    </div>
            </div>
    
            <div class="modal-footer justify-content-center">
                <button type="submit" name="MakeOffer" class="btn btn-info btn-round">Make Offer</button>
    
            </div>
            </form>
        </div>
    </div>
    </div>
    <!-- end make offer modal -->
    
    
     <!-- edit modal -->
     <div class="modal fade modal-xl" id="edit_offer_{{req.id}}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
     aria-hidden="true">
     <div class="modal-dialog modal-notice">
         <div class="modal-content">
            <div class="modal-header text-center" style="background: purple; color: white;">
                 <h5 class="modal-title" id="myModalLabel">Make an offer</h5>
                 <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                     <i class="material-icons">close</i>
                 </button>
             </div>
             <div class="modal-body">
                 <form method="POST" action="{% url 'supplier:edit_offer' req.offer_id %}">
                     {% csrf_token %}
                     <div class="form-group">
                         <lable>Fuel Type</lable>
                         <input type="text" name="fuel_type" class="form-control" value="{{req.fuel_type}}" disabled/>
                     </div>
     
                     <div class="form-group">
                         <lable>Fuel Quantity</lable>
                         <input type="text" name="quantity" class="form-control" value="{{req.offer_quantity}}" />
                     </div>
                     <div class="form-group">
                         <lable>Fuel Price</lable>
                         <input type="text" name="price" class="form-control" value="{{req.offer_price}}" />
                     </div>
                     <label class="form-group">Select Payment Method</label>
                     <div class="col-sm-12 row">
                            <div class="togglebutton form-group col">
                                <label>
                                    <input type="checkbox" name="cash" id="cash">
                                    <span class="toggle"></span>
                                    Cash
                                </label>
                            </div>
                            <div class="togglebutton form-group col">
                                <label>
                                    <input type="checkbox" name="ecocash" id="ecocash">
                                    <span class="toggle" value="True"></span>
                                    Ecocash
                                </label>
                            </div>
                            <div class="togglebutton form-group col">
                                <label>
                                    <input type="checkbox" name="swipe" id="swipe">
                                    <span class="toggle"></span>
                                    Swipe
                                </label>
                            </div>
                            <div class="togglebutton form-group col">
                                <label>
                                    <input type="checkbox" name="usd" id="usd">
                                    <span class="toggle"></span>
                                    USD
                                </label>
                            </div>
                        </div>
     
     
                     <div class="form-group">
                         <label>Pick Up Method</label>
                         <select id="delivery_method1{{forloop.counter}}" name="delivery_method1" class="form-control">
                            <option value='DELIVERY'>Delivery</option>
                            <option value='SELF COLLECTION'>Self Collection</option>
                         </select>
                     </div>
     
                     <div class="form-group" name='choices1' id='choices1{{forloop.counter}}'>
                         <label>Collection Address</label>
                         <div class="row form-group">                            
                                 <div class="togglebutton form-group col">
                                   <label for="">Street Number</label>
                                   <input type="text" class="form-control" name="s_number" id="" aria-describedby="helpId" placeholder="">
                                   
                                 </div>
                                 <div class="togglebutton form-group col">
                                   <label for="">Street Name</label>
                                   <input type="text" class="form-control" name="s_name" id="" aria-describedby="helpId" placeholder="">
                                   
                                 </div>
                                 <div class="togglebutton form-group col">
                                   <label for="">Location/Town</label>
                                   <input type="text" class="form-control" name="s_town" id="" aria-describedby="helpId" placeholder="">
                                  
                                 </div>
                             
                         </div>
                         <label>Available Equipments</label>
                         <div class="row">
                             <div class="col">
                                 <input class="form-control-md" type="checkbox" value='False' id="pump_available"
                                     name="pump_available">
                                 <label for="pump_available">Pump </label>
                                 
                             </div>
                             <div class="col">
                                 <input class="form-control-md" type="checkbox" value="False" id="dipping_stick_available"
                                     name="dipping_stick_available">
                                 <label for="dipping_stick_available">Dipping Stick </label>
                             </div>
     
                             <div class="col">
                                 <input class="form-control-md" type="checkbox" value="False" id="meter_available"
                                     name="meter_available">
                                 <label for="meter_available">Meter</label>
                             </div>
                         </div>
                     </div>
             </div>
     
             <div class="modal-footer justify-content-center">
                 <button type="submit" name="MakeOffer" class="btn btn-info btn-round">Update Offer</button>
     
             </div>
             </form>
         </div>
     </div>
     </div>
     <!-- end edit modal -->
                                {%endfor%}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
    {%endblock%}