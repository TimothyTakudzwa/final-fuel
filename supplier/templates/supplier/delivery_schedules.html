{% extends "supplier/supplier_base.html" %}
{% load humanize %}

{% block body %}
<!-- Content Header (Page header) -->
<section class="content-header">
    <div class="header-icon">
      <i class="fa fa-truck"></i>
    </div>
    <div class="header-title">
      <h1>Delievery Schedules</h1>
      <small>{{ request.user.company.name|title }}</small>
      <ol class="breadcrumb hidden-xs">
          <li><a href="{%url 'fuel-request'%}"><i class="pe-7s-home"></i> Home</a></li>
          <li class="active">Schedules</li>
      </ol>
    </div>
  </section>

<section class="content">
    <div class="content">
        <div class="panel panel-bd lobidrag lobipanel lobipanel-sortable" data-inner-id="nMPzTfz4dU"
            data-index="0">
            <div class="panel-heading ui-sortable-handle">
                <div class="btn-group"> 
                    <h4>Delivery Schedules</h4>
                </div>
                
                <div class="dropdown">
                    <ul class="dropdown-menu dropdown-menu-right">
    
    
                    </ul>
                    <div class="dropdown-toggle" data-toggle="dropdown"><span
                            class="panel-control-icon glyphicon glyphicon-cog"></span>
                    </div>
                </div>
            </div>
            <div class="panel-body">              
          
          <div class="table-responsive">
            <table id="delivery_example" class="table table-striped table-bordered" style="width:100%">
                <thead style="background-color: lightslategray; color:white;">
                    <tr>
                        <td></td>
                        <th style="color: white;">Recipient</th>
                        <th style="color: white;">Address</th>
                        <th style="color: white;">Product</th>
                        <th style="color: white;">Quantity</th>
                        <th style="color: white;">Transporter</th>
                        <th style="color: white;">Status</th>
                        <th style="color: white;">Action</th>
                        <th style="color: white;">Add. Information</th>  
                    </tr>
                </thead>
                <tbody>
                    {% for delivery in schedules %}
                    <tr>
                        <td></td>
                        <td>{{ delivery.transaction.buyer.company.name|title }}</td>
                        <td>{{delivery.delivery_address}}</td>
                        <td>{{ delivery.transaction.offer.request.fuel_type}}</td>
                        <td>{{ delivery.delivery_quantity }} </td>
                        <td>{{ delivery.transport_company}}</td>
                       
                        <td>                            
                        {% if delivery.confirmation_document %}
                        <!-- <a class="btn btn-primary btn-sm" href="{% url 'supplier:view_confirmation_doc' delivery.id %}" >View Confirmation </a> -->
                        <button type="button" class="btn btn-purple btn-sm" data-toggle="modal"
                            data-target="#state_{{delivery.id}}">Status</button>
                        {% else %}
                        Pending
                        {%endif%}
                      </td>
                      <td>
                        <button type="button" class="btn btn-purple btn-sm" data-toggle="modal"
                            data-target="#edit_delivery_{{delivery.id}}">Edit Schedule</button>
                      </td>
                      <td><button class="btn btn-primary" data-toggle="modal" data-target="#additonal_information{{delivery.id}}">
                        More Info
                        </button></td>
                    </tr>
                    <div class="modal fade modal-success in" id="edit_delivery_{{delivery.id}}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
                          aria-hidden="true">
                          <div class="modal-dialog modal-notice">
                          <div class="modal-content">
                          <div class="modal-header">
                              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                              <span class="modal-title">Edit Delivery Schedule</span>
                          </div>
                          <div class="modal-body" style="margin-bottom: 150px;">
                          <form method="POST" action="{% url 'supplier:edit_delivery_schedule' %}">
                              {% csrf_token %}
                              <div class=" row col-sm-12" style="margin-bottom: 5px;">
                              

                              <div class="col-sm-4" style="margin-bottom: 10px;">
                                  <label style="margin-bottom: 5px;">Driver Name</label>
                                  <input type="text" name="driver_name" class="form-control" value="{{delivery.driver_name}}" />
                              </div>
                              <div class="col-sm-4" style="margin-bottom: 10px;">
                                  <label style="margin-bottom: 5px;">Phone Number</label>
                                  <input type="text" name="phone_number" class="form-control" value="{{delivery.phone_number}}"/>
                              </div>
                              <div class="col-sm-4" style="margin-bottom: 10px;">
                                <label style="margin-bottom: 5px;">Tran. Company</label>
                                <input type="text" name="transport_company" class="form-control" value="{{delivery.transport_company}}"/>
                            </div>
                              </div>
                              <div class=" row col-sm-12">
                                <div class="col-sm-4" style="margin-bottom: 10px;">
                                    <label style="margin-bottom: 5px;">Id Number</label>
                                    <input type="text" name="id_number" class="form-control" value="{{delivery.id_number}}" />
                                </div>
  
                                <div class="col-sm-4" style="margin-bottom: 10px;">
                                    <label style="margin-bottom: 5px;">Vehicle Registration</label>
                                    <input type="text" name="vehicle_reg" class="form-control" value="{{delivery.vehicle_reg}}" />
                                </div>
                                <div class="col-sm-4" style="margin-bottom: 10px;">
                                    <label style="margin-bottom: 5px;">Delivery Date</label>
                                    <input type="date" name="delivery_date" class="form-control" value="{{delivery.date}}"/>
                                </div>
                                </div>
                              
                                <div class=" row col-sm-12">
    
                                  <div class="col-sm-4" style="margin-bottom: 10px;">
                                      <input type="hidden" name="delivery_id" class="form-control" value="{{delivery.id}}"/>
                                  </div>
                                  
                                  </div>
                          </div>

                          <div class="modal-footer">
                            <div class="row pull-right" style="margin-right: 15px;">                
                                <button class="btn btn-primary" type="submit">Save Changes</button>
                            </div>
                        </div>
                          </form>
                          </div>
                          </div>
                    </div>
                        
                    <div class="modal fade modal-success in" id="additonal_information{{delivery.id}}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
                        aria-hidden="true" style="overflow-y: initial !important;">
                        <div class="modal-dialog modal-notice">
                            <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                                <span class="modal-title">Additional Information</span>
                            </div>
                                <div class="modal-body" style="padding: 30px;height: 400px;overflow-y: auto;">
                                    <div class="row" style="padding: 10px;">
                                        <p class="col-md-6" style="font-weight: bold;">Delivery Date/Time: </p>
                                        <p class="col-md-6">{{ delivery.date }} | {{ delivery.delivery_time }}</p>
                                    </div>
                                    <div class="row" style="padding: 10px;">
                                        <p class="col-md-6" style="font-weight: bold;">Recipient: </p>
                                        <p class="col-md-6">{{ delivery.transaction.buyer.company.name|title }}</p>
                                    </div>
                                    <div class="row" style="padding: 10px;">
                                        <p class="col-md-6" style="font-weight: bold;">Address: </p>
                                        <p class="col-md-6">{{delivery.delivery_address}}</p>
                                    </div>
                                    <div class="row" style="padding: 10px;">
                                        <p class="col-md-6" style="font-weight: bold;">Product: </p>
                                        <p class="col-md-6">{{delivery.transaction.offer.request.fuel_type}}</p>
                                    </div>
                                    <div class="row" style="padding: 10px;">
                                        <p class="col-md-6" style="font-weight: bold;">Transporter </p>
                                        <p class="col-md-6">{{delivery.transport_company}}</p>
                                    </div>
                                    <div class="row" style="padding: 10px;">
                                        <p class="col-md-6" style="font-weight: bold;">Quantity: </p>
                                        <p class="col-md-6">{{delivery.delivery_quantity}} (Litres)</p>
                                    </div>
                                    <div class="row" style="padding: 10px;">
                                        <p class="col-md-6" style="font-weight: bold;">Contact Person: </p>
                                        <p class="col-md-6">{{delivery.transaction.buyer.first_name|title}} {{delivery.transaction.buyer.last_name|title}} </p>
                                    </div>
                                    <div class="row" style="padding: 10px;">
                                        <p class="col-md-6" style="font-weight: bold;">Contact Phone: </p>
                                        <p class="col-md-6">{{delivery.transaction.buyer.phone_number}}</p>
                                    </div>       
                                    <div class="row" style="padding: 10px;">
                                        <p class="col-md-6" style="font-weight: bold;">Driver Name: </p>
                                        <p class="col-md-6">{{delivery.driver_name}}</p>
                                    </div>   
                                    <div class="row" style="padding: 10px;">
                                        <p class="col-md-6" style="font-weight: bold;"> Driver Phone Number: </p>
                                        <p class="col-md-6">{{delivery.phone_number}}</p>
                                    </div>   
                                    <div class="row" style="padding: 10px;">
                                        <p class="col-md-6" style="font-weight: bold;">Id Number: </p>
                                        <p class="col-md-6">{{delivery.id_number}}</p>
                                    </div>   
                                    <div class="row" style="padding: 10px;">
                                        <p class="col-md-6" style="font-weight: bold;">Vehicle Reg: </p>
                                        <p class="col-md-6">{{delivery.vehicle_reg}}</p>
                                    </div>
                                    <div class="row" style="padding: 10px;">
                                        <p class="col-md-6" style="font-weight: bold;">Tank Details: </p>
                                        <p class="col-md-6">{{delivery.transaction.offer.request.storage_tanks}}</p>
                                    </div>
                                    
                                    <div class="row" style="padding: 10px;">
                                        <p class="col-md-6" style="font-weight: bold;">Equipment Required: </p>
                                        <p class="col-md-6">
                                            {% if delivery.transaction.offer.request.pump_required %}
                                            Pump
                                            {% endif %}
                                            {% if delivery.transaction.offer.request.dipping_stick_required %}
                                            Dipping Stick
                                            {% endif %}
                                            {% if delivery.transaction.offer.request.meter_required %}
                                            Meter Required
                                            {% else %}
                                            N/A
                                            {% endif %}
                                        </p>
                                    </div>
                                    <div class="row" style="padding: 10px;">
                                        <p class="col-md-6" style="font-weight: bold;">Status: </p>
                                        {% if delivery.confirmation_document %}
                                        <p class="col-md-6"> 
                                            <a class="btn btn-purple btn-sm" href="{% url 'supplier:view_confirmation_doc' delivery.id %}">View Confirmation Doc</a>
                                        </p>       
                                        {%else %}
                                        <p class="col-md-6">Status: Pending </p>    
                                        {% endif %} 
                                    </div>           

                                </div>
                                </div>
                                
                            </div>
                        </div>
                    </div> 

                    <div class="modal fade modal-success in" id="state_{{delivery.id}}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
                          aria-hidden="true">
                        <div class="modal-dialog modal-notice">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                                    <span class="modal-title">Delivery Status
                                    {%if not delivery.supplier_document%}
                                    (Not Reconciled)
                                    {% else %}
                                    (Reconciled)
                                    {%endif%}

                                    </span>
                                </div>
                                <div class="modal-body" style="margin-bottom: 15px;">
                                    <div class="row" style="padding-left: 15px;">
                                    <!-- Confirmation Documents -->
                                    <div class="col-md-6">
                                        <h4>Buyer Confirmation</h4>
                                        <div class="col-md-6" style="padding: 10px;">
                                        <!-- <p class="col-md-12" style="font-weight: 100; margin-bottom: 30px;">View {{delivery.transaction.buyer.company.name|title}}'s Confirmation: </p> -->

                                        <a class="btn btn-info btn-sm" href="{% url 'supplier:view_confirmation_doc' delivery.id %}" >View Confirmation </a>

                                        </div>
                                    </div>
                                    <!--end of confirmation docx  -->
                                    <!-- Support Documents -->
                                    <div class="col-md-6">
                                    <h4>Supplier Confirmation</h4>
                                    {% if not delivery.supplier_document %}
                                    <p class="col-md-12" style="font-weight: 100; margin-bottom:30px;">Upload Confirmation Document: </p>
                                    <div style="padding-left: 15px;">
                                    <form method="POST" action="" enctype="multipart/form-data">
                                    {% csrf_token %}
                                    <input type="text" name="delivery_id" value="{{delivery.id}}" hidden/>
                                    <div class="form-group">
                                    <input type="file" name="supplier_document" class="form-control-file" id="exampleFormControlFile1">
                                    </div>
                                    <div class="form-group">
                                    <input class="btn btn-info btn-sm" type="submit" value="Submit">
                                    </div>
                                    </form>
                                    </div>    
                                    {% else %}
                                    <div class="" style="padding: 10px;">
                                    <!-- <p class="col-md-12" style="font-weight: 100; margin-bottom: 30px;">View Uploaded Doc: </p> -->

                                    <div class="btn-group">
                                    <a class="btn btn-info btn-sm pull-left" href="{% url 'supplier:view_supplier_doc' delivery.id %}" >View Document </a>
                                    <a class="btn btn-info btn-purple btn-sm" href="{% url 'supplier:del_supplier_doc' delivery.id %}" >Upload Another </a>


                                    </div> 
                                    {%endif%}

                                    </div>
                                    <!--end of support docx  -->


                                    </div>


                                    </div>
                                    <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>

                                    </div>

                                </div>




                            </div>
                        </div>
                    </div>


                    


                    {%endfor%}
                </tbody>
                </table>
    
    </div>
    </div>
    </div>
    </div>
</section>  


  
{%endblock%}
