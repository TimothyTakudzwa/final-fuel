{% extends "users/base.html" %}
{% load crispy_forms_tags %}
{% load humanize %}
{% load static %}
{% load staticfiles %}
{% block body %}

    <section class="content-header">
        <form action="#" method="get" class="sidebar-form search-box pull-right hidden-md hidden-lg hidden-sm">
            <div class="input-group">
                <input type="text" name="q" class="form-control" placeholder="Search...">
                <span class="input-group-btn">
                <button type="submit" name="search" id="search-btn" class="btn"><i class="fa fa-search"></i></button>
            </span>
            </div>
        </form>
        <!-- <div class="header-icon">
            <i class="fa fa-clipboard"></i>
        </div> -->
        <div class="header-title" style="margin-left: 0px;">

            <h1>Fuel Allocations</h1>
            <small>Zimbabwe Fuel Management System</small>
            <ol class="breadcrumb hidden-xs">
                <li><a href="#"><i class="pe-7s-home"></i> Home</a></li>
                <li class="active">Allocations</li>
            </ol>

        </div>

    </section>


    <section class="content">

        {% if company_capacity %}
        <div class="panel panel-bd lobidrag lobipanel lobipanel-sortable" data-inner-id="nMPzTfz4dU" data-index="0">
            <div class="panel-heading ui-sortable-handle">
                <div class="btn-group">
                    <h4>Company Fuel</h4>
                </div>
                <div class="dropdown">
                    <ul class="dropdown-menu dropdown-menu-right">
    
    
                    </ul>
                    <div class="dropdown-toggle" data-toggle="dropdown"><span
                            class="panel-control-icon glyphicon glyphicon-cog"></span>
                    </div>
                </div>
            </div>
            <div class="panel-body">
    
    
                <div class="table-responsive">
                    <table id="company_table" class="table table-striped table-bordered" style="width:100%">
                        <thead>
                            <tr>
                                <th style="color: #ffb61e;">Diesel Capacity</th>
                                <th style="color: #009688;">Petrol Capacity</th>
                                <th style="color: #ffb61e;">Unallocated Diesel</th>
                                <th>RTGS Price</th>
                                <th>USD Price</th>
                                <th style="color: #009688;">Unallocated Petrol</th>
                                <th>RTGS Price</th>
                                <th>USD Price</th>
                                <th>Action</th>
    
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
    
                                
                                <td>{{company_total_diesel_capacity|floatformat:2|intcomma }}</td>
                                <td>{{company_total_petrol_capacity|floatformat:2|intcomma}}</td>
                                <td>{{company_capacity.unallocated_diesel|floatformat:2|intcomma}}</td>
                                <td>{{company_capacity.diesel_price}}</td>
                                <td>{{company_capacity.usd_diesel_price}}</td>
                                <td>{{company_capacity.unallocated_petrol|floatformat:2|intcomma}}</td>
                                <td>{{company_capacity.petrol_price}}</td>
                                <td>{{company_capacity.usd_petrol_price}}</td>
                                <td>
                                <div class="btn-group">
                                    <a class="btn btn-info btn-sm" data-toggle="modal"
                                        data-target="#place_order{{company_capacity.id}}">Place Order</a>
                                </div>
                                </td>
                            </tr>
                            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
                            <script>
                                $(document).ready(function () {
                                if ($('#id_depot option').length === 0){
                                    $('#submit_order').prop('disabled', true)
                                }   
    
    
                                $('#fuel_type').show();
                                $('#currency').show();
                                $('#diesel_rtgs_price').hide();
                                $('#diesel_usd_price').hide();
                                $('#petrol_rtgs_price').show();
                                $('#petrol_usd_price').hide();
                               
                                
                                
                                $('#fuel_type, #currency').change(function () {
                                if ($('#fuel_type option:selected').text() == "Diesel") {
                                    if ($('#currency option:selected').text() == "USD") {
                                        $('#currency').show();
                                        $('#diesel_rtgs_price').hide();
                                        $('#diesel_usd_price').show();
                                        $('#petrol_rtgs_price').hide();
                                        $('#petrol_usd_price').hide();
                                    
                                     }
    
                                    else {
                                        $('#currency').show();
                                        $('#diesel_rtgs_price').show();
                                        $('#diesel_usd_price').hide();
                                        $('#petrol_rtgs_price').hide();
                                        $('#petrol_usd_price').hide();
                                    }
    
                                }
    
                                else {
                                    if ($('#currency option:selected').text() == "USD") {
                                        $('#currency').show();
                                        $('#diesel_rtgs_price').hide();
                                        $('#diesel_usd_price').hide();
                                        $('#petrol_rtgs_price').hide();
                                        $('#petrol_usd_price').show();
                                    
                                     }
    
                                    else {
                                        $('#currency').show();
                                        $('#diesel_rtgs_price').hide();
                                        $('#diesel_usd_price').hide();
                                        $('#petrol_rtgs_price').show();
                                        $('#petrol_usd_price').hide();
                                    }
    
                                }
                             
                                 });
                                    });
                                </script>
    
    
                            <div class="modal fade modal-success in" id="place_order{{company_capacity.id}}" tabindex="-1" role="dialog"
                            aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                            <div class=" modal-dialog" role="document" style="margin: 0;">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <span class="modal-title" id="exampleModalLongTitle">Place Order<i
                                                style="color:azure"><small style="color: rgba(5, 5, 5, 0.911);"> pay for fuel to NOIC and upload proof of payment</small></i></span>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div>
                                        {% load crispy_forms_tags %}
                                        <form action="{% url 'users:place_order' %}" name="placing_order" method="POST" enctype="multipart/form-data" novalidate>
                                            {% csrf_token %}
                                            <input type="hidden"  id="quantity" name="quantity" />
                                            <div class="form-group row col-sm-12" style="margin-top: 5%;">
                                                <div class="col-sm-6" id="fuel_type">
    
                                                    <label><b style='color:#009688'>Fuel Type</b></label>
                                                    <select class="form-control" name="fuel_type">
    
                                                        <option>Petrol</option>
                                                        <option>Diesel</option>
    
    
                                                    </select>
                                                </div>
                                                <div class="col-sm-6" id="fuel_paid">
                                                    <label><b style='color:#009688'>Sub Total <i style="color: black;">(payment)</i></b></label>
                                                    <input type="number" min="0.1" step="0.01" id="fuel_paid" name="fuel_paid" class="form-control"
                                                        placeholder="$0.00" required />
                                                </div>
                                               
                                            </div>
                                            <div class=" form-group row col-sm-12">
                                                <div class="col-sm-6" id="currency">
    
                                                    <label><b style='color:#009688'>Currency</b></label>
                                                    <select class="form-control" name="currency">
    
                                                        <option>RTGS</option>
                                                        <option>USD</option>
    
    
                                                    </select>
                                                </div>
                                                <div class="col-sm-6" id="diesel_rtgs_price">
                                                    <label><b style='color:#009688'>Price</b></label>
                                                    <input type="number" min="0.1" step="0.01" name="diesel_rtgs_price" class="form-control"
                                                        value="{{diesel_rtgs_price}}" id="diesel_rtgs_price_input"  />
                                                </div>
                                                <div class="col-sm-6" id="diesel_usd_price">
                                                    <label><b style='color:#009688'>Price</b></label>
                                                    <input type="number" min="0.1" step="0.01" name="diesel_usd_price" class="form-control"
                                                        value="{{diesel_usd_price}}" id="diesel_usd_price_input"  />
                                                </div>
                                                <div class="col-sm-6" id="petrol_rtgs_price">
                                                    <label><b style='color:#009688'>Price</b></label>
                                                    <input type="number" min="0.1" step="0.01" name="petrol_rtgs_price" class="form-control"
                                                        value="{{petrol_rtgs_price}}" id="petrol_rtgs_price_input"  />
                                                </div>
                                                <div class="col-sm-6" id="petrol_usd_price">
                                                    <label><b style='color:#009688'>Price</b></label>
                                                    <input type="number" min="0.1" step="0.01" name="petrol_usd_price" class="form-control"
                                                        value="{{petrol_usd_price}}" id="petrol_usd_price_input"  />
                                                </div>
    
                                            </div>
    
                                            <div class=" form-group row col-sm-12">
                                                <div class="col-sm-6" id=quantity>
                                                    <label><b style='color:#009688'>Quantity</b></label>
                                                    <input type="text" name="quantity" class="form-control"
                                                    placeholder="In Litres" id="quantity" disabled/>
                                                </div>
                                                <div class="col-md-6">
                                                    {{ form1.depot|as_crispy_field }}
                                                 </div>
    
                                                
                                                
                                            </div>
                                            <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
                                            <script>
                                                // $( "#fuel_paid" ).keyup(function() {
                                                //     console.log( "Handler for .keyup() called." );
                                                //     });
                                                                                
    
                                                    function update() {
                                                        console.log("Check Check")
                                                        if ($('#fuel_type option:selected').text() == "Diesel"){
                                                            if ($('#currency option:selected').text() == "USD") {
                                                                $('input[name="quantity"]').val(parseFloat($('input[name="fuel_paid"]').val()/$('input[name="diesel_usd_price"]').val()).toFixed(2)) ;
                                                            }else if ($('#currency option:selected').text() == "RTGS") {
                                                                $('input[name="quantity"]').val(parseFloat($('input[name="fuel_paid"]').val()/$('input[name="diesel_rtgs_price"]').val()).toFixed(2));
                                                            }
                                                        }else{
                                                            if ($('#currency option:selected').text() == "USD") {
                                                                $('input[name="quantity"]').val(parseFloat($('input[name="fuel_paid"]').val()/$('input[name="petrol_usd_price"]').val()).toFixed(2));
                                                            }else if ($('#currency option:selected').text() == "RTGS"){
                                                                $('input[name="quantity"]').val(parseFloat($('input[name="fuel_paid"]').val()/$('input[name="petrol_rtgs_price"]').val()).toFixed(2));
                                                            }
    
                                                        }
                                                        if ($('#quantity').val() === "NaN" || $('#quantity').val() === "Infinity" ){
                                                            if ($("#submit_order").is(":disabled") === false) {
                                                                $('#submit_order').prop('disabled', true) 
                                                            }    
                                                        } else{
                                                            if ($("#submit_order").is(":disabled") === true) {
                                                                $('#submit_order').prop('disabled', false)    
                                                            }
    
                                                        } 
                                                    }
    
                                                    $("#fuel_paid").keyup(function(){
                                                        update();
                                                    
                                                    });
                                                    $("#diesel_rtgs_price_input").keyup(function(){
                                                        update();
                                                    
                                                    });$("#diesel_usd_price_input").keyup(function(){
                                                        update();
                                                    
                                                    });$("#petrol_rtgs_price_input").keyup(function(){
                                                        update();
                                                    
                                                    });$("#petrol_usd_price_input").keyup(function(){
                                                        update();
                                                    
                                                    });
                                                    $('#currency').on('change', 'select', function() {
                                                        // console.log("Achinja");
                                                        update();
                                                    });
                                                    $('#fuel_type').on('change', 'select', function() {
                                                        // console.log("Achinja");
                                                        update();
                                                    });
                                     
                                             </script>
                                            
    
                                            <div class=" form-group row col-sm-12">
    
                                                <div class="col-sm-6">
                                                    <label><b style='color:#009688'>Payment Proof</b></label>
                                                    <input type="file" accept=".pdf, .doc,.docx, .jpeg, .png, .jpg" name="proof_of_payment" class="form-control-file" id="exampleFormControlFile1" required>
                                                </div>
    
                                                <div class="col-sm-6">
    
                                                    <label><b style='color:#009688'>Transporter</b></label>
                                                    <input type="text" name="transporter" class="form-control"
                                                     required />
                                                </div>
                                                
                                               
                                            </div>
    
                                            <div class=" form-group row col-sm-12">
    
                                                <div class="col-sm-6">
    
                                                    <label><b style='color:#009688'>Truck Horse Reg</b></label>
                                                    <input type="text" name="truck_reg" class="form-control"
                                                     required />
                                                </div>
    
                                                <div class="col-sm-6">
    
                                                    <label><b style='color:#009688'>Trailer Reg</b></label>
                                                    <input type="text" name="trailer_reg" class="form-control"
                                                     required />
                                                </div>
                                                
                                               
                                            </div>
                                            <div class=" form-group row col-sm-12">
    
                                                <div class="col-sm-6">
    
                                                    <label><b style='color:#009688'>Driver</b></label>
                                                    <input type="text" name="driver" class="form-control"
                                                     required />
                                                </div>
    
                                                <div class="col-sm-6">
    
                                                    <label><b style='color:#009688'>Driver ID</b></label>
                                                    <input type="text" name="driver_id" class="form-control"
                                                     required />
                                                </div>
                                                
                                               
                                            </div>
                                    </div>
                                    <div class="modal-footer">  
                                        <button type="submit" class="btn btn-primary" id="submit_order">Submit</button>
                                        <button class="btn btn-default" data-dismiss="modal" >Close</button>
                                    </div> 
                                    </form>
                                </div>
                            </div>
                        </div>
    
    
    
                            <!-- Supplier Edit Modal -->
                            <div class="modal fade modal-success in" id="company_petrol{{company_capacity.id}}"
                                tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                <div class="modal-dialog" style="margin: 0;" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header">
    
                                            <span class="modal-title" id="exampleModalLabel">Update Company Petrol</span>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                            {% load crispy_forms_tags %}
                                            <form action="{% url 'users:company_petrol' company_capacity.id %}"
                                                method="POST">
                                                {% csrf_token %}
    
    
                                                <div class="form-group">
                                                    <lable>Petrol Capacity</lable>
                                                    <input type="number" min="0.1" step="0.01" name="petrol_quantity" class="form-control"
                                                        value="{{company_capacity.petrol_quantity}}" />
                                                </div>
    
                                                <div class="form-group">
                                                    <lable>Petrol Price</lable>
                                                    <input type="number" min="0.1" step="0.01" name="petrol_price" class="form-control"
                                                        value="{{company_capacity.petrol_price}}" />
                                                </div>
    
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        {{update_form.cash|as_crispy_field}}
                                                    </div>
                                                    <div class="col-md-6">
                                                        {{update_form.usd|as_crispy_field}}
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        {{update_form.swipe|as_crispy_field}}
                                                    </div>
                                                    <div class="col-md-6">
                                                        {{update_form.ecocash|as_crispy_field}}
                                                    </div>
                                                </div>
    
                                        </div>
                                        <div class="form-group row"
                                            style="margin-left: 2%; margin-right: 5%; margin-top: 5%; margin-bottom: 5%;">
                                            <button type="button" class="btn btn-secondary col-sm-6"
                                                data-dismiss="modal">Close</button>
                                            <button type="submit" class="btn btn-primary col-sm-6">Update</button>
                                        </div>
                                        </form>
                                        </form>
                                    </div>
                                </div>
                            </div>
                </div>
    
                <!-- Supplier Edit Modal -->
                <div class="modal fade modal-success in" id="company_diesel{{company_capacity.id}}" tabindex="-1"
                    role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog" style="margin: 0;" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <span class="modal-title" id="exampleModalLabel">Update Company Diesel</span>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                {% load crispy_forms_tags %}
                                <form action="{% url 'users:company_diesel' company_capacity.id %}" method="POST">
                                    {% csrf_token %}
    
    
                                    <div class="form-group">
                                        <lable>Diesel Capacity</lable>
                                        <input type="number" min="0.1" step="0.01" name="diesel_quantity" class="form-control"
                                            value="{{company_capacity.diesel_quantity}}" />
                                    </div>
    
                                    <div class="form-group">
                                        <lable>Diesel Price</lable>
                                        <input type="number" min="0.1" step="0.01" name="diesel_price" class="form-control"
                                            value="{{company_capacity.diesel_price}}" />
                                    </div>
    
                                    <div class="row">
                                        <div class="col-md-6">
                                            {{update_form.cash|as_crispy_field}}
                                        </div>
                                        <div class="col-md-6">
                                            {{update_form.usd|as_crispy_field}}
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            {{update_form.swipe|as_crispy_field}}
                                        </div>
                                        <div class="col-md-6">
                                            {{update_form.ecocash|as_crispy_field}}
                                        </div>
                                    </div>
    
                            </div>
                            <div class="form-group row"
                                style="margin-left: 2%; margin-right: 5%; margin-top: 5%; margin-bottom: 5%;">
                                <button type="button" class="btn btn-secondary col-sm-6" data-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-primary col-sm-6">Update</button>
                            </div>
                            </form>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            </tbody>
    
    
    
    
            </table>
        </div>
    
    
    </section>
    </div>
    <script>
        $('body').click(function (event) {
            if(!$(event.target).closest('#place_order{{company_capacity.id}}').length && !$(event.target).is('#place_order')) {
                $("#place_order{{company_capacity.id}}").modal('hide');
            }
            // if(!$(event.target).closest('#new_depot_user').length && !$(event.target).is('#new_depot_user')) {
            //     $("#new_depot_user").modal('hide');
            // }      
        });
    </script>
    {% endif %}


    <section class="content">
        <div class="mt-2 panel panel-bd lobidrag lobipanel lobipanel-sortable" data-inner-id="nMPzTfz4dU" data-index="0">
            <div class="panel-heading ui-sortable-handle">
                <div class="btn-group">
                    <h4> Subsidiaries - <small><i>Click on Subsidiary to view fuel allocations and allocate fuel</i></small>
                    </h4>
                </div>
                <div class="dropdown">
                    <ul class="dropdown-menu dropdown-menu-right">


                    </ul>
                    <div class="dropdown-toggle" data-toggle="dropdown"><span
                            class="panel-control-icon glyphicon glyphicon-cog"></span>
                    </div>
                </div>
            </div>
            <div class="panel-body">


                <div class="table-responsive">
                    <table id="fuel_allocations" class="table table-striped table-bordered" style="width:100%">
                        <thead>
                        <tr>

                            <th>Subsidiary Name</th>
                            <th>Type</th>
                            <th style="color: #ffb61e;">Diesel Quantity</th>
                            <!-- <th>Price</th> -->
                            <th style="color: #009688;">Petrol Quantity</th>
                            <!-- <th>Price</th> -->

                            <th>Action</th>
                        </tr>
                        </thead>
                        <tbody>

                        {% for allocate in allocates %}
                            <tr>

                                <td>{{allocate.subsidiary.name}}</td>
                                {% if allocate.subsidiary.is_depot == True %}
                                    <td>Depot</td>
                                {% else %}
                                    <td>Service Station</td>
                                {% endif %}
                                <td style="color: #ffb61e;">{{allocate.diesel_quantity|floatformat:2|intcomma}} {% if allocate.diesel_quantity < 1000 %} <i
                                        class="fa fa-exclamation-triangle"
                                        style="margin-left: 2.5px;color: #ff5722;"></i>{% endif %}</td>

                                <td style="color: #009688;">{{allocate.petrol_quantity|floatformat:2|intcomma}} {% if allocate.petrol_quantity < 1000 %} <i
                                        class="fa fa-exclamation-triangle"
                                        style="margin-left: 2.5px;color: #ff5722;"></i>{% endif %}</td>

                                <td>
                                    {% if allocate.subsidiary.is_depot == True %}
                                        <div class="btn-group">


                                            <a class="btn btn-labeled btn-success btn-sm" data-toggle="modal"
                                               href="{%url 'users:allocatedfuel' allocate.subsidiary.id %}">
                                               <span class="btn-label"><i class="fa fa-eye"></i></span>View Fuel
                                                Allocations</a>

                                        </div>
                                    {% else %}
                                        <div class="btn-group">

                                            <a class="btn btn-info btn-sm" data-toggle="modal"
                                               data-target="#add_petrol_fuel{{allocate.id}}">Add Petrol</a>
                                            <a class="btn btn-warning btn-sm" data-toggle="modal"
                                               data-target="#add_diesel_fuel{{allocate.id}}">Add Diesel</a>
                                            <a class="btn btn-default btn-sm"
                                               style="background-color: steelblue; color: white;border: 1px solid transparent;"
                                               data-toggle="modal" data-target="#add_fuel{{allocate.id}}">Edit Prices</a>
                                        </div>
                                    {% endif %}
                                </td>
                            </tr>
                            <!--Add Petrol fuel-->
                            <div class="modal fade modal-success in" id="add_petrol_fuel{{allocate.id}}" tabindex="-1"
                                 role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                                <div class=" modal-dialog-centered" role="document" style="margin: 0;">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                    <span class="modal-title" id="exampleModalLongTitle">Add Fuel - Petrol <i
                                            style="color:azure; margin-left: 2.4px;"><small>Please Note the fuel you are
                                                entering is to be
                                                sold in Zimbabwean Dollars</small></i></span>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <div>
                                            {% load crispy_forms_tags %}
                                            <form action="{% url 'users:allocation_update_main' allocate.id %}" method="POST">
                                                {% csrf_token %}
                                                <input type="hidden" value="RTGS" name="fuel_payment_type" />
                                                <div class="form-group row col-sm-12" style="margin-top: 5%;">
                                                    <div class="col-sm-6">

                                                        <label><b style='color:#009688'>Fuel Type</b></label>


                                                        <label><b style='color:#009688'>Fuel Type</b></label>
                                                        <select class="form-control" name="fuel_type">
                                                            <option>Petrol</option>




                                                        </select>
                                                    </div>
                                                    <div class="col-sm-6">
                                                        <label><b style='color:#009688'>Quantity</b></label>
                                                        <input type="number" min="0.1" step="0.01" name="quantity" class="form-control"
                                                               placeholder="In Litres" required />
                                                    </div>
                                                </div>
                                                <div class=" form-group row col-sm-12">
                                                    <div class="col-sm-6">
                                                        <label><b style='color:#009688'>Price</b></label>
                                                        <input type="number" min="0.1" step="0.01" name="price" class="form-control" placeholder="Price"
                                                               required />
                                                    </div>
                                                    <input type="hidden" name="cash" value="0" />
                                                    <input type="hidden" name="swipe" value="0">
                                                    <input type="hidden" name="ecocash" value="0">
                                                    <div class="col-sm-6" name="payment" id="payment{{forloop.counter}}">
                                                        <label><b style='color:#009688'>Payment Method</b></label>
                                                        <div class="col-sm-12 row">
                                                            <input type="checkbox" class=" col-sm-6" name="cash" value="1">
                                                            Cash<br>
                                                            <input type="checkbox" class="col-sm-6" value="1"
                                                                   name="swipe">Swipe<br>
                                                            <input type="checkbox" class="col-sm-6" value="1"
                                                                   name="ecocash">Ecocash<br>
                                                        </div>
                                                    </div>
                                                </div>




                                        </div>
                                        <div class="modal-footer">
                                            <button type="submit" class="btn btn-primary">Save changes</button>

                                            <button type="button" class="btn btn-default"
                                                    data-dismiss="modal">Close</button>
                                        </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <!--Add Diesel fuel-->
                            <div class="modal fade modal-success in" id="add_diesel_fuel{{allocate.id}}" tabindex="-1"
                                 role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                                <div class=" modal-dialog" role="document" style="margin: 0;">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                    <span class="modal-title" id="exampleModalLongTitle">Add Fuel - Diesel <i
                                            style="color:azure; margin-left: 2.5px;"><small>Please Note the fuel you are
                                                entering is to be
                                                sold in United States Dollars</small></i></span>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <div>
                                            {% load crispy_forms_tags %}
                                            <form action="{% url 'users:allocation_update_main' allocate.id %}" method="POST">
                                                {% csrf_token %}
                                                <input type="hidden" value="USD" name="fuel_payment_type" />
                                                <div class="form-group row col-sm-12" style="margin-top: 5%;">
                                                    <div class="col-sm-6">

                                                        <label><b style='color:#009688'>Fuel Type</b></label>
                                                        <select class="form-control" name="fuel_type">
                                                            <option>Diesel</option>




                                                        </select>
                                                    </div>
                                                    <div class="col-sm-6">
                                                        <label><b style='color:#009688'>Quantity</b></label>
                                                        <input type="number" min="0.1" step="0.01" name="quantity" class="form-control"
                                                               placeholder="In Litres" required />
                                                    </div>
                                                </div>
                                                <div class=" form-group row col-sm-12">
                                                    <div class="col-sm-6">
                                                        <label><b style='color:#009688'>Price</b></label>
                                                        <input type="number" min="0.1" step="0.01" name="price" class="form-control" placeholder="Price"
                                                               required />
                                                    </div>
                                                    <input type="hidden" name="cash" value="0" />
                                                    <input type="hidden" name="swipe" value="0">
                                                    <input type="hidden" name="ecocash" value="0">
                                                    <div class="col-sm-6" name="payment" id="payment{{forloop.counter}}">
                                                        <label><b style='color:#009688'>Payment Method</b></label>
                                                        <div class="col-sm-12 row">
                                                            <input type="checkbox" class=" col-sm-6" name="cash" value="1">
                                                            Cash<br>
                                                            <input type="checkbox" class="col-sm-6" value="1"
                                                                   name="swipe">Swipe<br>
                                                            <input type="checkbox" class="col-sm-6" value="1"
                                                                   name="ecocash">Ecocash<br>
                                                        </div>
                                                    </div>
                                                </div>




                                        </div>
                                        <div class="modal-footer">
                                            <button type="submit" class="btn btn-primary">Save changes</button>

                                            <button type="button" class="btn btn-default"
                                                    data-dismiss="modal">Close</button>
                                        </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <!--Edit Allocation-->
                            <div class="modal fade modal-success in" id="add_fuel{{allocate.id}}" tabindex="-1" role="dialog"
                                 aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                                <div class=" modal-dialog-centered" role="document" style="margin: 0;">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                    <span class="modal-title" id="exampleModalLongTitle">Edit Prices <i
                                            style="padding-left: 5px;"><small>Please Note the fuel you are entering is
                                                to be
                                                sold in ZWL</small></i></span>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <div>
                                            {% load crispy_forms_tags %}
                                            <form action="{% url 'users:edit_fuel_prices' allocate.id %}" method="POST">
                                                {% csrf_token %}
                                                <input type="hidden" value="USD" name="fuel_payment_type" />
                                                <!-- <div class="form-group row col-sm-12" style="margin-top: 5%;">
                                                    <div class="col-sm-6">
                                                        <label><b style='color:#009688'>Fuel Type</b></label>
                                                        <select class="form-control" name="fuel_type">
                                                            <option>Petrol</option>
                                                            <option>Diesel</option>
                                                        </select>
                                                    </div>
                                                </div> -->
                                                <div class=" form-group row col-sm-12" style="margin-top: 10px;">
                                                    <div class="col-sm-6">
                                                        <label><b style='color:#009688'>Petrol Price</b></label>
                                                        <input type="number" min="0.1" step="0.01" name="petrol_price" class="form-control"
                                                               placeholder="In RTGS Dollars" value="{{allocate.petrol_price}}"
                                                               required />
                                                    </div>
                                                    <!-- <input type="hidden" name="cash" value="0" />
                                            <input type="hidden" name="swipe" value="0">
                                            <input type="hidden" name="ecocash" value="0">
                                            <div class="col-sm-6" name="payment" id="payment{{forloop.counter}}">
                                                <label><b style='color:#009688'>Payment Method</b></label>
                                                <div class="col-sm-12 row">
                                                    <input type="checkbox" class=" col-sm-6" name="cash" value="1">
                                                    Cash<br>
                                                    <input type="checkbox"
                                                        class="col-sm-6" value="1" name="swipe">Swipe<br>
                                                    <input type="checkbox"
                                                        class="col-sm-6" value="1" name="ecocash">Ecocash<br>
                                                </div>
                                            </div> -->
                                                </div>
                                                <div class=" form-group row col-sm-12">
                                                    <div class="col-sm-6">
                                                        <label><b style='color:#009688'>Diesel Price</b></label>
                                                        <input type="number" min="0.1" step="0.01" name="diesel_price" class="form-control"
                                                               placeholder="In United States Dollars"
                                                               value="{{allocate.diesel_price}}" required />
                                                    </div>
                                                    <input type="hidden" name="cash" value="0" />
                                                    <input type="hidden" name="swipe" value="0">
                                                    <!-- <div class="col-sm-6" name="payment" id="payment{{forloop.counter}}">
                                                <label><b style='color:#009688'>Payment Method</b></label>
                                                <div class="col-sm-12 row">
                                                    <input type="checkbox" class=" col-sm-6" name="cash" value="1">
                                                    Cash<br>
                                                    <input type="checkbox"
                                                        class="col-sm-6" value="1" name="swipe">FCA<br>
                                                </div>
                                            </div> -->
                                                </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="submit" class="btn btn-primary">Save changes</button>
                                            <button type="button" class="btn btn-default "
                                                    data-dismiss="modal">Close</button>
                                            
                                        </div>
                                        </form>
                                    </div>
                                </div>
                            </div>


                            <!-- Supplier Edit Modal -->
                            <div class="modal fade modal-success in" id="edit_{{allocate.id}}" tabindex="-1" role="dialog"
                                 aria-labelledby="exampleModalLabel" aria-hidden="true">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">

                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                                    aria-hidden="true"></span></button>
                                            <h1 class="modal-title">Edit Price</h1>
                                        </div>
                                        <div class="modal-body">
                                            {% load crispy_forms_tags %}
                                            <form action="{% url 'users:edit_fuel_prices' allocate.id %}" method="POST">
                                                {% csrf_token %}


                                                <div class="form-group">
                                                    <lable>Petrol Price</lable>
                                                    <input type="number" min="0.1" step="0.01" name="petrol_price" class="form-control"
                                                           value="{{allocate.petrol_price}}" />
                                                </div>

                                                <div class="form-group">
                                                    <lable>Diesel Price</lable>
                                                    <input type="number" min="0.1" step="0.01" name="diesel_price" value="{{allocate.diesel_price}}"
                                                           class="form-control" />
                                                </div>

                                                <div class="row">
                                                    <div class="col-md-6">
                                                        {{update_form.cash|as_crispy_field}}
                                                    </div>
                                                    <div class="col-md-6">
                                                        {{update_form.usd|as_crispy_field}}
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        {{update_form.swipe|as_crispy_field}}
                                                    </div>
                                                    <div class="col-md-6">
                                                        {{update_form.ecocash|as_crispy_field}}
                                                    </div>
                                                </div>

                                        </div>
                                        <div class="modal-footer">
                                            <div>
                                                <button class="btn" style="background-color: lightgray; color: #333;"
                                                        data-dismiss="modal">No</button> <button type="submit"
                                                                                                 class="btn btn-primary ">Submit</button>
                                            </div>
                                            </form>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!--update fuel-->
                            <div class="modal fade modal-success in" id="petrol{{allocate.id}}" tabindex="-1" role="dialog"
                                 aria-labelledby="exampleModalLabel" aria-hidden="true">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                                    aria-hidden="true"></span></button>
                                            <h1 class="modal-title">Update Petrol Quantity</h1>
                                        </div>
                                        <div class="modal-body">

                                            {% load crispy_forms_tags %}
                                            <form action="{% url 'users:allocation_update' allocate.id %}" method="POST">
                                                {% csrf_token %}
                                                <div class="form-group">
                                                    <lable>Petrol Capacitdy</lable>
                                                    <input type="number" min="0.1" step="0.01" name="petrol_quantity" class="form-control" value=" "
                                                           required />
                                                </div>

                                                <div class="row">
                                                    <div class="col-md-6">
                                                        {{update_form.cash|as_crispy_field}}
                                                    </div>
                                                    <div class="col-md-6">
                                                        {{update_form.usd|as_crispy_field}}
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        {{update_form.swipe|as_crispy_field}}
                                                    </div>
                                                    <div class="col-md-6">
                                                        {{update_form.ecocash|as_crispy_field}}
                                                    </div>
                                                </div>

                                                <div class="form-group row"
                                                     style="margin-left: 2%; margin-right: 5%; margin-top: 5%; margin-bottom: 5%;">
                                                    <button type="button" class="btn btn-secondary col-sm-6"
                                                            data-dismiss="modal">Close</button>
                                                    <button type="submit" class="btn btn-primary col-sm-6">Update</button>
                                                </div>
                                            </form>
                                        </div>

                                    </div>
                                </div>
                            </div>


                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>    


    {% if allocations %}
    <section class="content">
        <div class="mt-2 panel panel-bd lobidrag lobipanel lobipanel-sortable" data-inner-id="nMPzTfz4dU" data-index="0">
            <div class="panel-heading ui-sortable-handle">
                <div class="btn-group">
                    <h4>Fuel Allocations Audit Trail</h4>
                </div>
                <div class="dropdown">
                    <ul class="dropdown-menu dropdown-menu-right">


                    </ul>
                    <div class="dropdown-toggle" data-toggle="dropdown"><span
                            class="panel-control-icon glyphicon glyphicon-cog"></span>
                    </div>
                </div>
            </div>
            <div class="panel-body">


                <div class="table-responsive">
                    <table id="audit_table" class="table table-striped table-bordered" style="width:100%">
                        <thead>
                        <tr>
                            <th>Date</th>
                            <th>Subsidiary Name</th>
                            <th>Sub Type</th>
                            <th>Action</th>
                            <th style="color: #ffb61e;">Diesel</th>
                            <th>Price</th>
                            <th style="color: #009688;">Petrol</th>
                            <th>Price</th>
                            <th>Payment</th>
                            <th>Action</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for alloc in allocations %}
                            <tr>

                                <td>{{alloc.date}}</td>
                                <td>{{alloc.subsidiary_name}}</td>
                                <td>{{alloc.sub_type}}</td>
                                <td>{{alloc.action}}</td>
                                {% if alloc.diesel_quantity != 0 %}
                                    <td style="color: #ffb61e;">{{alloc.diesel_quantity|floatformat:2|intcomma}}</td>
                                    <td>{{alloc.diesel_price}}</td>
                                {% else %}
                                    <td>-</td>
                                    <td>-</td>
                                {% endif %}
                                {% if alloc.petrol_quantity != 0 %}
                                    <td style="color: #009688;">{{alloc.petrol_quantity|floatformat:2|intcomma}}</td>
                                    <td>{{alloc.petrol_price}}</td>
                                {% else %}
                                    <td>-</td>
                                    <td>-</td>
                                {%endif%}
                                <td>{{alloc.fuel_payment_type}}</td>
                                <td>

                                    <button class="btn btn-labeled btn-success btn-sm"  data-toggle="modal"
                                            data-target="#change_{{alloc.id}}"><span class="btn-label"><i class="fa fa-edit"></i></span>Edit Allocation</button>

                                </td>
                            </tr>


                            <div class="modal fade modal-success in" id="change_{{alloc.id}}" tabindex="-1" role="dialog"
                                 aria-labelledby="exampleModalLabel" aria-hidden="true">
                                <div class="modal-dialog" role="document" style="margin: 0">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                    <span class="modal-title" id="exampleModalLabel" style="size: 20px;">Edit Previous
                                        Allocation</span>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <div class="modal-body">

                                            {% load crispy_forms_tags %}
                                            <form action="{% url 'users:edit_allocation' alloc.id %}" method="POST">
                                                {% csrf_token %}
                                                {% if alloc.diesel_quantity > 0 %}
                                                    <div class="row">
                                                        <div class="form-group col-md-6">
                                                            <lable>Diesel User Input</lable>
                                                            <input type="number" min="0.1" step="0.01" class="form-control"
                                                                   value="{{alloc.diesel_quantity}}" />
                                                        </div>

                                                        <div class="form-group col-md-6">
                                                            <lable>Actual Diesel Quantity</lable>
                                                            <input type="number" min="0.1" step="0.01" name="diesel_quantity" class="form-control"
                                                                   value="" />
                                                        </div>
                                                    </div>
                                                    <div class="row">

                                                        <div class="form-group col-md-6">
                                                            <lable></lable>
                                                            <input type="hidden" name="petrol_quantity" class="form-control"
                                                                   value="0" />
                                                        </div>
                                                    </div>
                                                {% endif %}

                                                {% if alloc.petrol_quantity > 0 %}
                                                    <div class="row">
                                                        <div class="form-group col-md-6">
                                                            <lable>Petrol User Input</lable>
                                                            <input type="number" min="0.1" step="0.01" class="form-control"
                                                                   value="{{alloc.petrol_quantity}}" />
                                                        </div>

                                                        <div class="form-group col-md-6">
                                                            <lable>Actual Petrol Quantity</lable>
                                                            <input type="number" min="0.1" step="0.01" name="petrol_quantity" class="form-control"
                                                                   value="" />
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <lable></lable>
                                                        <input type="hidden" name="diesel_quantity" class="form-control"
                                                               value="0" />
                                                    </div>
                                                {% endif %}
                                                <div class="modal-footer">
                                                    <button type="submit" class="btn btn-primary">Update</button>

                                                    <button type="button" class="btn btn-default "
                                                            data-dismiss="modal">Close</button>
                                                </div>
                                            </form>
                                        </div>

                                    </div>
                                </div>
                            </div>
                            <script>
                                $('body').click(function (event) {
                                    if(!$(event.target).closest('#change_{{alloc.id}}').length && !$(event.target).is('#change_{{alloc.id}}')) {
                                        $("#change_{{alloc.id}}").modal('hide');
                                    }
                                        
                                });
                            </script>

                        {% endfor %}
                        </tbody>
                    </table>
                </div>


            </div>
        </div>
    </section>    

    {% else %}
    <section class="content">
        <div class="" style="margin-top: 20px">
            <h4 class="text-center">No Audit Trail</h4>
        </div>
    </section>    
    {% endif %}

    

{% endblock %}