{% extends "users/base.html" %}
{% load crispy_forms_tags %}
{% load staticfiles %}
{% block body %}

    <div class="container">

        <div class="text-center">
            <h1>Fuel Allocations</h1>
        </div>

        {% if company_capacity %}
            <div class="mt-2 panel panel-bd lobidrag lobipanel lobipanel-sortable" data-inner-id="nMPzTfz4dU" data-index="0">
                <div class="panel-heading ui-sortable-handle">
                    <div class="btn-group">
                        <h4>Company Unallocated Fuel</h4>
                    </div>
                    <div class="dropdown">
                        <ul class="dropdown-menu dropdown-menu-right">


                        </ul>
                        <div class="dropdown-toggle" data-toggle="dropdown"><span class="panel-control-icon glyphicon glyphicon-cog"></span>
                        </div>
                    </div>
                </div>       <div class="panel-body">


                <div class="table-responsive">
                    <table id="example" class="table table-striped table-bordered" style="width:100%">
                        <thead>
                        <tr>
                            <th>Diesel Quantity</th>
                            <th>Diesel Price</th>
                            <th>Petrol Quantity</th>
                            <th>Petrol Price</th>
                            <th>Payment Methods</th>
                            <th>Action</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>



                            <td>{{company_capacity.diesel_quantity}}</td>
                            <td>{{company_capacity.diesel_price}}</td>
                            <td>{{company_capacity.petrol_quantity}}</td>
                            <td>{{company_capacity.petrol_price}}</td>
                            <td>{%if company_capacity.cash%}<i class="fa fa-dollar"></i> <img src="{% static 'assets/img/zimbabwe.svg' %}" alt="ZWL" height="25px" width="25px" title="ZWL"> {% else%} {%endif%} {%if company_capacity.usd%}<img src="{% static 'assets/img/united-states.svg' %}" alt="USD" height="25px" width="25px" title="USD"> {% else%} {%endif%} {%if company_capacity.ecocash%}<img src="{% static 'assets/img/ecocash.svg' %}" alt="Ecocash" height="50px" width="50px" title="ECOCASH">{% else%} {%endif%} {%if company_capacity.swipe%}<i class="fa fa-cc-visa"></i> {% else%} {%endif%}</td>
                            <td>
                                <button class="btn btn-primary btn-sm" style="font-size: 8px;" data-toggle="modal" data-target="#company_petrol{{company_capacity.id}}">Update Company Unallocated Petrol</button>
                                <button class="btn btn-warning btn-sm" style="font-size: 8px;" data-toggle="modal" data-target="#company_diesel{{company_capacity.id}}">Update Company Unallocated Diesel</button>
                            </td>
                        </tr>
                        <!-- Supplier Edit Modal -->
                        <div class="modal fade" id="company_petrol{{company_capacity.id}}" tabindex="-1" role="dialog"
                             aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header" style="background-color: #9c27b0;color: white;">

                                        <h5 class="modal-title" id="exampleModalLabel">Update Company Petrol</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        {% load crispy_forms_tags %}
                                        <form action="{% url 'users:company_petrol' company_capacity.id %}" method="POST">
                                            {% csrf_token %}


                                            <div class="form-group">
                                                <lable>Petrol Capacity</lable>
                                                <input type="text" name="petrol_quantity" class="form-control" value="{{company_capacity.petrol_quantity}}" />
                                            </div>

                                            <div class="form-group">
                                                <lable>Petrol Price</lable>
                                                <input type="text" name="petrol_price" class="form-control" value="{{company_capacity.petrol_price}}" />
                                            </div>

                                            <div class="row">
                                                <div class="col-md-6">
                                                    {{update_form.cash|as_crispy_field}}
                                                </div>
                                                <div class="col-md-6">
                                                    {{update_form.usd|as_crispy_field}}
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    {{update_form.swipe|as_crispy_field}}
                                                </div>
                                                <div class="col-md-6">
                                                    {{update_form.ecocash|as_crispy_field}}
                                                </div>
                                            </div>

                                    </div>
                                    <div class="modal-footer">
                                        <div >
                                            <button class="btn" style="background-color: lightgray; color: #333333;" data-dismiss="modal">No</button> <button type="submit" class="btn btn-primary ">Submit</button>
                                        </div>
                                        </form>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Supplier Edit Modal -->
                        <div class="modal fade" id="company_diesel{{company_capacity.id}}" tabindex="-1" role="dialog"
                             aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header" style="background-color: #9c27b0;color: white;">

                                        <h5 class="modal-title" id="exampleModalLabel">Update Company Diesel</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        {% load crispy_forms_tags %}
                                        <form action="{% url 'users:company_diesel' company_capacity.id %}" method="POST">
                                            {% csrf_token %}


                                            <div class="form-group">
                                                <lable>Diesel Capacity</lable>
                                                <input type="text" name="diesel_quantity" class="form-control" value="{{company_capacity.diesel_quantity}}" />
                                            </div>

                                            <div class="form-group">
                                                <lable>Diesel Price</lable>
                                                <input type="text" name="diesel_price" class="form-control" value="{{company_capacity.diesel_price}}" />
                                            </div>

                                            <div class="row">
                                                <div class="col-md-6">
                                                    {{update_form.cash|as_crispy_field}}
                                                </div>
                                                <div class="col-md-6">
                                                    {{update_form.usd|as_crispy_field}}
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    {{update_form.swipe|as_crispy_field}}
                                                </div>
                                                <div class="col-md-6">
                                                    {{update_form.ecocash|as_crispy_field}}
                                                </div>
                                            </div>

                                    </div>
                                    <div class="modal-footer">
                                        <div >
                                            <button class="btn" style="background-color: lightgray; color: #333333;" data-dismiss="modal">No</button> <button type="submit" class="btn btn-primary ">Submit</button>
                                        </div>
                                        </form>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                        </tbody>




                    </table>
                </div>


            </div>
            </div>
        {% endif %}

        <div class="text-center">
            <h1>Fuel Allocations & Updates</h1>
        </div>

        {% if allocates %}
            <div class="mt-2 panel panel-bd lobidrag lobipanel lobipanel-sortable" data-inner-id="nMPzTfz4dU" data-index="0">
                <div class="panel-heading ui-sortable-handle">
                    <div class="btn-group">
                        <h4>Fuel Allocations & Updates</h4>
                    </div>
                    <div class="dropdown">
                        <ul class="dropdown-menu dropdown-menu-right">


                        </ul>
                        <div class="dropdown-toggle" data-toggle="dropdown"><span class="panel-control-icon glyphicon glyphicon-cog"></span>
                        </div>
                    </div>
                </div>       <div class="panel-body">


                <div class="table-responsive">
                    <table id="example" class="table table-striped table-bordered" style="width:100%">
                        <thead>
                        <tr>
                            <th>Name</th>
                            <th>Type</th>
                            <th>Diesel</th>
                            <th>Price</th>
                            <th>Petrol</th>
                            <th>Price</th>
                            <th>Payment</th>
                            <th>Action</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for allocate in allocates %}
                            <tr>

                                <td>{{allocate.subsidiary_name}}</td>
                                <td>{{allocate.sub_type}}</td>
                                <td>{{allocate.diesel_quantity}} {% if allocate.diesel_quantity < 1000 %} <i class="material-icons text-danger" >warning</i>{% endif %}</td>
                                <td>{{allocate.diesel_price}}</td>
                                <td>{{allocate.petrol_quantity}} {% if allocate.petrol_quantity < 1000 %} <i class="material-icons text-danger" >warning</i>{% endif %}</td>
                                <td>{{allocate.petrol_price}}</td>
                                <td>{%if allocate.cash%}<i class="fa fa-dollar"></i> <img src="{% static 'assets/img/zimbabwe.svg' %}" alt="ZWL" height="25px" width="25px" title="ZWL">{% else%} {%endif%} {%if allocate.usd%}<img src="{% static 'assets/img/united-states.svg' %}" alt="USD" height="25px" width="25px" title="USD"> {% else%} {%endif%} {%if allocate.ecocash%}<img src="{% static 'assets/img/ecocash.svg' %}" alt="Ecocash" height="50px" width="50px" title="ECOCASH">{% else%} {%endif%} {%if allocate.swipe%}<i class="fa fa-cc-visa"></i> {% else%} {%endif%}</td>
                                <td>
                                    <div class = "btn-group">
                                        <button class="btn btn-primary btn-sm" style="font-size: 8px;" data-toggle="modal" data-target="#petrol{{allocate.id}}">Add Petrol</button>
                                        <button class="btn btn-warning btn-sm" style="font-size: 8px;" data-toggle="modal" data-target="#diesel{{allocate.id}}">Add Diesel</button>
                                        <button class="btn btn-success btn-sm" style="font-size: 8px;" data-toggle="modal" data-target="#edit_{{allocate.id}}">Edit Prices</button>
                                    </div>
                                </td>
                            </tr>


                            <!-- Supplier Edit Modal -->
                            <div class="modal fade" id="edit_{{allocate.id}}" tabindex="-1" role="dialog"
                                 aria-labelledby="exampleModalLabel" aria-hidden="true">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header" style="background-color: #9c27b0;color: white;">

                                            <h5 class="modal-title" id="exampleModalLabel">Edit Prices</h5>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                            {% load crispy_forms_tags %}
                                            <form action="{% url 'users:edit_fuel_prices' allocate.id %}"
                                                  method="POST">
                                                {% csrf_token %}


                                                <div class="form-group">
                                                    <lable>Petrol Price</lable>
                                                    <input type="text" name="petrol_price" class="form-control" value="{{allocate.petrol_price}}" />
                                                </div>

                                                <div class="form-group">
                                                    <lable>Diesel Price</lable>
                                                    <input type="text"  name="diesel_price"  value="{{allocate.diesel_price}}" class="form-control" />
                                                </div>

                                                <div class="row">
                                                    <div class="col-md-6">
                                                        {{update_form.cash|as_crispy_field}}
                                                    </div>
                                                    <div class="col-md-6">
                                                        {{update_form.usd|as_crispy_field}}
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        {{update_form.swipe|as_crispy_field}}
                                                    </div>
                                                    <div class="col-md-6">
                                                        {{update_form.ecocash|as_crispy_field}}
                                                    </div>
                                                </div>

                                        </div>
                                        <div class="modal-footer">
                                            <div >
                                                <button class="btn" style="background-color: lightgray; color: #333;" data-dismiss="modal">No</button> <button type="submit" class="btn btn-primary ">Submit</button>
                                            </div>
                                            </form>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!--update fuel-->
                            <div class="modal fade" id="petrol{{allocate.id}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
                                 aria-hidden="true">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header" style="background-color: #9c27b0;color: white;">
                                            <h5 class="modal-title" id="exampleModalLabel">Update Petrol Quantity</h5>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <div class="modal-body">

                                            {% load crispy_forms_tags %}
                                            <form action="{% url 'users:allocation_update' allocate.id %}" method="POST">
                                                {% csrf_token %}
                                                <div class="form-group">
                                                    <lable>Petrol Capacitdy</lable>
                                                    <input type="text" name="petrol_quantity" class="form-control" value=" " required/>
                                                </div>

                                                <div class="row">
                                                    <div class="col-md-6">
                                                        {{update_form.cash|as_crispy_field}}
                                                    </div>
                                                    <div class="col-md-6">
                                                        {{update_form.usd|as_crispy_field}}
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        {{update_form.swipe|as_crispy_field}}
                                                    </div>
                                                    <div class="col-md-6">
                                                        {{update_form.ecocash|as_crispy_field}}
                                                    </div>
                                                </div>

                                                <div class="modal-footer">
                                                    <button type="button" class="btn" style="background-color: lightgray; color: #333;" data-dismiss="modal">Close</button>
                                                    <button class="btn btn-primary" type="submit">Update</button>
                                                </div>
                                            </form>
                                        </div>

                                    </div>
                                </div>
                            </div>

                            <div class="modal fade" id="diesel{{allocate.id}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
                                 aria-hidden="true">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header" style="background-color: #9c27b0;color: white;">
                                            <h5 class="modal-title" id="exampleModalLabel">Update Diesel Quantity</h5>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <div class="modal-body">

                                            {% load crispy_forms_tags %}
                                            <form action="{% url 'users:allocate_diesel' allocate.id %}" method="POST">
                                                {% csrf_token %}
                                                <div class="form-group">
                                                    <lable>Diesel Capacity</lable>
                                                    <input type="text" name="diesel_quantity" class="form-control" value=" " />
                                                </div>

                                                <div class="row">
                                                    <div class="col-md-6">
                                                        {{update_form.cash|as_crispy_field}}
                                                    </div>
                                                    <div class="col-md-6">
                                                        {{update_form.usd|as_crispy_field}}
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        {{update_form.swipe|as_crispy_field}}
                                                    </div>
                                                    <div class="col-md-6">
                                                        {{update_form.ecocash|as_crispy_field}}
                                                    </div>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn" style="background-color: lightgray; color: #000;" data-dismiss="modal">Close</button>
                                                    <button class="btn btn-primary" type="submit">Update</button>
                                                </div>
                                            </form>
                                        </div>

                                    </div>
                                </div>
                            </div>

                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            </div>
        {% else %}
            <div class="text-center" style="margin-top: 50px">
                <h4>Nothing To Show</h4>
            </div>
        {% endif %}


        <div class="text-center">
            <h1>Fuel Allocations Audit Trail</h1>
        </div>


        {% if allocations %}
            <div class="mt-2 panel panel-bd lobidrag lobipanel lobipanel-sortable" data-inner-id="nMPzTfz4dU" data-index="0">
                <div class="panel-heading ui-sortable-handle">
                    <div class="btn-group">
                        <h4>Fuel Allocations Audit Trail</h4>
                    </div>
                    <div class="dropdown">
                        <ul class="dropdown-menu dropdown-menu-right">


                        </ul>
                        <div class="dropdown-toggle" data-toggle="dropdown"><span class="panel-control-icon glyphicon glyphicon-cog"></span>
                        </div>
                    </div>
                </div>       <div class="panel-body">


                <div class="table-responsive">
                    <table id="example" class="table table-striped table-bordered" style="width:100%">
                        <thead>
                        <tr>
                            <th>Date</th>
                            <th>Subsidiary Name</th>
                            <th>Sub Type</th>
                            <th>Action</th>
                            <th>Diesel</th>
                            <th>Price</th>
                            <th>Petrol</th>
                            <th>Price</th>
                            <th>Payment</th>
                            <th>Action</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for alloc in allocations %}
                            <tr>

                                <td>{{alloc.date}}</td>
                                <td>{{alloc.subsidiary_name}}</td>
                                <td>{{alloc.sub_type}}</td>
                                <td>{{alloc.action}}</td>
                                {% if alloc.diesel_quantity != 0 %}
                                    <td>{{alloc.diesel_quantity}}</td>
                                    <td>{{alloc.diesel_price}}</td>
                                {% else %}
                                    <td>-</td>
                                    <td>-</td>
                                {% endif %}
                                {% if alloc.petrol_quantity != 0 %}
                                    <td>{{alloc.petrol_quantity}}</td>
                                    <td>{{alloc.petrol_price}}</td>
                                {% else %}
                                    <td>-</td>
                                    <td>-</td>
                                {%endif%}
                                <td>{%if alloc.cash%}<i class="fa fa-dollar"></i> <img src="{% static 'assets/img/zimbabwe.svg' %}" alt="ZWL" height="25px" width="25px" title="ZWL">{% else%} {%endif%} {%if alloc.usd%}<img src="{% static 'assets/img/united-states.svg' %}" alt="USD" height="25px" width="25px" title="USD"> {% else%} {%endif%} {%if alloc.ecocash%}<img src="{% static 'assets/img/ecocash.svg' %}" alt="Ecocash" height="50px" width="50px" title="ECOCASH">{% else%} {%endif%} {%if alloc.swipe%}<i class="fa fa-cc-visa"></i> {% else%} {%endif%}</td>
                                <td>

                                    <button class="btn btn-primary btn-sm" style="font-size: 8px;" data-toggle="modal" data-target="#change_{{alloc.id}}">Edit Allocation</button>

                                </td>
                            </tr>


                            <div class="modal fade" id="change_{{alloc.id}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
                                 aria-hidden="true">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header" style="background-color: #9c27b0;color: white;">
                                            <h5 class="modal-title" id="exampleModalLabel">Edit Previous Allocation</h5>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <div class="modal-body">

                                            {% load crispy_forms_tags %}
                                            <form action="{% url 'users:edit_allocation' alloc.id %}" method="POST">
                                                {% csrf_token %}
                                                {% if alloc.diesel_quantity > 0 %}
                                                    <div class="form-group">
                                                        <lable>Diesel User Input</lable>
                                                        <input type="text" class="form-control" value="{{alloc.diesel_quantity}}" />
                                                    </div>

                                                    <div class="form-group">
                                                        <lable>Actual Diesel Quantity</lable>
                                                        <input type="text" name="diesel_quantity" class="form-control" value="" />
                                                    </div>
                                                    <div class="form-group">
                                                        <lable></lable>
                                                        <input type="hidden" name="petrol_quantity" class="form-control" value="0" />
                                                    </div>
                                                {% endif %}

                                                {% if alloc.petrol_quantity > 0 %}
                                                    <div class="form-group">
                                                        <lable>Petrol User Input</lable>
                                                        <input type="text" class="form-control" value="{{alloc.petrol_quantity}}" />
                                                    </div>

                                                    <div class="form-group">
                                                        <lable>Actual Petrol Quantity</lable>
                                                        <input type="text" name="petrol_quantity" class="form-control" value="" />
                                                    </div>
                                                    <div class="form-group">
                                                        <lable></lable>
                                                        <input  type="hidden" name="diesel_quantity" class="form-control" value="0" />
                                                    </div>
                                                {% endif %}
                                                <div class="modal-footer">
                                                    <button type="button" class="btn" style="background-color: lightgray; color: #000;" data-dismiss="modal">Close</button>
                                                    <button class="btn btn-primary" type="submit">Update</button>
                                                </div>
                                            </form>
                                        </div>

                                    </div>
                                </div>
                            </div>

                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            </div>
        {% else %}
            <div class="text-center" style="margin-top: 50px">
                <h4>Nothing To Show</h4>
            </div>
        {% endif %}

    </div>

{% endblock %}